!function(){function t(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,i=[],s=!0,c=!1;try{for(n=n.call(t);!(s=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);s=!0);}catch(u){c=!0,o=u}finally{try{s||null==n.return||n.return()}finally{if(c)throw o}}return i}(t,e)||r(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,n,r){return(e=h()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&c(o,n.prototype),o}).apply(null,arguments)}function n(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||r(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function i(t,e,n){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=f(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(t){var e=h();return function(){var n,r=f(t);if(e){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return a(this,n)}}function a(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return l(t)}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function g(t,e,n){return e&&d(t.prototype,e),n&&d(t,n),t}!function(){"use strict";function r(t){return"function"==typeof t}var o=!1,c={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){var e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else o&&console.log("RxJS: Back to a better error behavior. Thank you. <3");o=t},get useDeprecatedSynchronousErrorHandling(){return o}};function a(t){setTimeout(function(){throw t},0)}var h={closed:!0,next:function(t){},error:function(t){if(c.useDeprecatedSynchronousErrorHandling)throw t;a(t)},complete:function(){}},d=Array.isArray||function(t){return t&&"number"==typeof t.length};function v(t){return null!==t&&"object"==typeof t}var b,y=function(){function t(t){return Error.call(this),this.message=t?"".concat(t.length," errors occurred during unsubscription:\n").concat(t.map(function(t,e){return"".concat(e+1,") ").concat(t.toString())}).join("\n  ")):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),w=function(){function t(e){p(this,t),this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return g(t,[{key:"unsubscribe",value:function(){var e;if(!this.closed){var n=this._parentOrParents,o=this._ctorUnsubscribe,i=this._unsubscribe,s=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof t)n.remove(this);else if(null!==n)for(var c=0;c<n.length;++c)n[c].remove(this);if(r(i)){o&&(this._unsubscribe=void 0);try{i.call(this)}catch(c){e=c instanceof y?m(c.errors):[c]}}if(d(s))for(var u=-1,a=s.length;++u<a;){var l=s[u];if(v(l))try{l.unsubscribe()}catch(h){e=e||[],h instanceof y?e=e.concat(m(h.errors)):e.push(h)}}if(e)throw new y(e)}}},{key:"add",value:function(e){var n=e;if(!e)return t.EMPTY;switch(typeof e){case"function":n=new t(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof t)){var r=n;(n=new t)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var o=n._parentOrParents;if(null===o)n._parentOrParents=this;else if(o instanceof t){if(o===this)return n;n._parentOrParents=[o,this]}else{if(-1!==o.indexOf(this))return n;o.push(this)}var i=this._subscriptions;return null===i?this._subscriptions=[n]:i.push(n),n}},{key:"remove",value:function(t){var e=this._subscriptions;if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}}}]),t}();function m(t){return t.reduce(function(t,e){return t.concat(e instanceof y?e.errors:e)},[])}w.EMPTY=((b=new w).closed=!0,b);var S="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),k=function(t){s(n,t);var e=u(n);function n(t,r,o){var i;switch(p(this,n),(i=e.call(this)).syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=h;break;case 1:if(!t){i.destination=h;break}if("object"==typeof t){t instanceof n?(i.syncErrorThrowable=t.syncErrorThrowable,i.destination=t,t.add(l(i))):(i.syncErrorThrowable=!0,i.destination=new E(l(i),t));break}default:i.syncErrorThrowable=!0,i.destination=new E(l(i),t,r,o)}return i}return g(n,[{key:S,value:function(){return this}},{key:"next",value:function(t){this.isStopped||this._next(t)}},{key:"error",value:function(t){this.isStopped||(this.isStopped=!0,this._error(t))}},{key:"complete",value:function(){this.isStopped||(this.isStopped=!0,this._complete())}},{key:"unsubscribe",value:function(){this.closed||(this.isStopped=!0,i(f(n.prototype),"unsubscribe",this).call(this))}},{key:"_next",value:function(t){this.destination.next(t)}},{key:"_error",value:function(t){this.destination.error(t),this.unsubscribe()}},{key:"_complete",value:function(){this.destination.complete(),this.unsubscribe()}},{key:"_unsubscribeAndRecycle",value:function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this}}],[{key:"create",value:function(t,e,r){var o=new n(t,e,r);return o.syncErrorThrowable=!1,o}}]),n}(w),E=function(t){s(n,t);var e=u(n);function n(t,o,i,s){var c;p(this,n),(c=e.call(this))._parentSubscriber=t;var u,a=l(c);return r(o)?u=o:o&&(u=o.next,i=o.error,s=o.complete,o!==h&&(r((a=Object.create(o)).unsubscribe)&&c.add(a.unsubscribe.bind(a)),a.unsubscribe=c.unsubscribe.bind(l(c)))),c._context=a,c._next=u,c._error=i,c._complete=s,c}return g(n,[{key:"next",value:function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;c.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}}},{key:"error",value:function(t){if(!this.isStopped){var e=this._parentSubscriber,n=c.useDeprecatedSynchronousErrorHandling;if(this._error)n&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):a(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;a(t)}}}},{key:"complete",value:function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var n=function(){return t._complete.call(t._context)};c.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}}},{key:"__tryOrUnsub",value:function(t,e){try{t.call(this._context,e)}catch(n){if(this.unsubscribe(),c.useDeprecatedSynchronousErrorHandling)throw n;a(n)}}},{key:"__tryOrSetError",value:function(t,e,n){if(!c.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,n)}catch(r){return c.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=r,t.syncErrorThrown=!0,!0):(a(r),!0)}return!1}},{key:"_unsubscribe",value:function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()}}]),n}(k),C="function"==typeof Symbol&&Symbol.observable||"@@observable";function _(t){return t}var T=function(){var t=function(){function t(e){p(this,t),this._isScalar=!1,e&&(this._subscribe=e)}return g(t,[{key:"lift",value:function(e){var n=new t;return n.source=this,n.operator=e,n}},{key:"subscribe",value:function(t,e,n){var r=this.operator,o=function(t,e,n){if(t){if(t instanceof k)return t;if(t[S])return t[S]()}return t||e||n?new k(t,e,n):new k(h)}(t,e,n);if(o.add(r?r.call(o,this.source):this.source||c.useDeprecatedSynchronousErrorHandling&&!o.syncErrorThrowable?this._subscribe(o):this._trySubscribe(o)),c.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o}},{key:"_trySubscribe",value:function(t){try{return this._subscribe(t)}catch(e){c.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),function(t){for(;t;){var e=t,n=e.closed,r=e.destination,o=e.isStopped;if(n||o)return!1;t=r&&r instanceof k?r:null}return!0}(t)?t.error(e):console.warn(e)}}},{key:"forEach",value:function(t,e){var n=this;return new(e=I(e))(function(e,r){var o;o=n.subscribe(function(e){try{t(e)}catch(n){r(n),o&&o.unsubscribe()}},r,e)})}},{key:"_subscribe",value:function(t){var e=this.source;return e&&e.subscribe(t)}},{key:C,value:function(){return this}},{key:"pipe",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return 0===e.length?this:function(t){return 0===t.length?_:1===t.length?t[0]:function(e){return t.reduce(function(t,e){return e(t)},e)}}(e)(this)}},{key:"toPromise",value:function(t){var e=this;return new(t=I(t))(function(t,n){var r;e.subscribe(function(t){return r=t},function(t){return n(t)},function(){return t(r)})})}}]),t}();return t.create=function(e){return new t(e)},t}();function I(t){if(t||(t=c.Promise||Promise),!t)throw new Error("no Promise impl found");return t}var x=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),P=function(t){s(n,t);var e=u(n);function n(t,r){var o;return p(this,n),(o=e.call(this)).subject=t,o.subscriber=r,o.closed=!1,o}return g(n,[{key:"unsubscribe",value:function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}}}]),n}(w),O=function(t){s(n,t);var e=u(n);function n(t){var r;return p(this,n),(r=e.call(this,t)).destination=t,r}return n}(k),D=function(){var t=function(t){s(n,t);var e=u(n);function n(){var t;return p(this,n),(t=e.call(this)).observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return g(n,[{key:S,value:function(){return new O(this)}},{key:"lift",value:function(t){var e=new j(this,this);return e.operator=t,e}},{key:"next",value:function(t){if(this.closed)throw new x;if(!this.isStopped)for(var e=this.observers,n=e.length,r=e.slice(),o=0;o<n;o++)r[o].next(t)}},{key:"error",value:function(t){if(this.closed)throw new x;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,n=e.length,r=e.slice(),o=0;o<n;o++)r[o].error(t);this.observers.length=0}},{key:"complete",value:function(){if(this.closed)throw new x;this.isStopped=!0;for(var t=this.observers,e=t.length,n=t.slice(),r=0;r<e;r++)n[r].complete();this.observers.length=0}},{key:"unsubscribe",value:function(){this.isStopped=!0,this.closed=!0,this.observers=null}},{key:"_trySubscribe",value:function(t){if(this.closed)throw new x;return i(f(n.prototype),"_trySubscribe",this).call(this,t)}},{key:"_subscribe",value:function(t){if(this.closed)throw new x;return this.hasError?(t.error(this.thrownError),w.EMPTY):this.isStopped?(t.complete(),w.EMPTY):(this.observers.push(t),new P(this,t))}},{key:"asObservable",value:function(){var t=new T;return t.source=this,t}}]),n}(T);return t.create=function(t,e){return new j(t,e)},t}(),j=function(t){s(n,t);var e=u(n);function n(t,r){var o;return p(this,n),(o=e.call(this)).destination=t,o.source=r,o}return g(n,[{key:"next",value:function(t){var e=this.destination;e&&e.next&&e.next(t)}},{key:"error",value:function(t){var e=this.destination;e&&e.error&&this.destination.error(t)}},{key:"complete",value:function(){var t=this.destination;t&&t.complete&&this.destination.complete()}},{key:"_subscribe",value:function(t){return this.source?this.source.subscribe(t):w.EMPTY}}]),n}(D),R=function(t){s(n,t);var e=u(n);function n(t,r){var o;return p(this,n),(o=e.call(this,t,r)).scheduler=t,o.work=r,o.pending=!1,o}return g(n,[{key:"schedule",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.closed)return this;this.state=t;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this}},{key:"requestAsyncId",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return setInterval(t.flush.bind(t,this),n)}},{key:"recycleAsyncId",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)}},{key:"execute",value:function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}},{key:"_execute",value:function(t,e){var n,r=!1;try{this.work(t)}catch(o){r=!0,n=!!o&&o||new Error(o)}if(r)return this.unsubscribe(),n}},{key:"_unsubscribe",value:function(){var t=this.id,e=this.scheduler,n=e.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null}}]),n}(function(t){s(n,t);var e=u(n);function n(t,r){return p(this,n),e.call(this)}return g(n,[{key:"schedule",value:function(t){return this}}]),n}(w)),N=function(){var t=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.now;p(this,t),this.SchedulerAction=e,this.now=n}return g(t,[{key:"schedule",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;return new this.SchedulerAction(this,t).schedule(n,e)}}]),t}();return t.now=function(){return Date.now()},t}(),A=function(t){s(n,t);var e=u(n);function n(t){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N.now;return p(this,n),(r=e.call(this,t,function(){return n.delegate&&n.delegate!==l(r)?n.delegate.now():o()})).actions=[],r.active=!1,r.scheduled=void 0,r}return g(n,[{key:"schedule",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;return n.delegate&&n.delegate!==this?n.delegate.schedule(t,e,r):i(f(n.prototype),"schedule",this).call(this,t,e,r)}},{key:"flush",value:function(t){var e=this.actions;if(this.active)e.push(t);else{var n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}}}]),n}(N),M=new(function(t){s(n,t);var e=u(n);function n(){return p(this,n),e.apply(this,arguments)}return n}(A))(function(t){s(n,t);var e=u(n);function n(t,r){var o;return p(this,n),(o=e.call(this,t,r)).scheduler=t,o.work=r,o}return g(n,[{key:"schedule",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e>0?i(f(n.prototype),"schedule",this).call(this,t,e):(this.delay=e,this.state=t,this.scheduler.flush(this),this)}},{key:"execute",value:function(t,e){return e>0||this.closed?i(f(n.prototype),"execute",this).call(this,t,e):this._execute(t,e)}},{key:"requestAsyncId",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return null!==r&&r>0||null===r&&this.delay>0?i(f(n.prototype),"requestAsyncId",this).call(this,t,e,r):t.flush(this)}}]),n}(R)),H=new T(function(t){return t.complete()});function W(t){return t?function(t){return new T(function(e){return t.schedule(function(){return e.complete()})})}(t):H}function F(t){return t&&"function"==typeof t.schedule}var q=function(t){return function(e){for(var n=0,r=t.length;n<r&&!e.closed;n++)e.next(t[n]);e.complete()}};function L(t,e){return new T(function(n){var r=new w,o=0;return r.add(e.schedule(function(){o!==t.length?(n.next(t[o++]),n.closed||r.add(this.schedule())):n.complete()})),r})}function U(t,e){return e?L(t,e):new T(q(t))}function B(t,e){return new T(e?function(n){return e.schedule(V,0,{error:t,subscriber:n})}:function(e){return e.error(t)})}function V(t){var e=t.error;t.subscriber.error(e)}var $=function(){function t(e,n,r){p(this,t),this.kind=e,this.value=n,this.error=r,this.hasValue="N"===e}return g(t,[{key:"observe",value:function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}}},{key:"do",value:function(t,e,n){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return n&&n()}}},{key:"accept",value:function(t,e,n){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,n)}},{key:"toObservable",value:function(){switch(this.kind){case"N":return function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e[e.length-1];return F(r)?(e.pop(),L(e,r)):U(e)}(this.value);case"E":return B(this.error);case"C":return W()}throw new Error("unexpected notification kind value")}}],[{key:"createNext",value:function(e){return void 0!==e?new t("N",e):t.undefinedValueNotification}},{key:"createError",value:function(e){return new t("E",void 0,e)}},{key:"createComplete",value:function(){return t.completeNotification}}]),t}();$.completeNotification=new $("C"),$.undefinedValueNotification=new $("N",void 0);var Y=function(t){s(n,t);var e=u(n);function n(t,r){var o,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return p(this,n),(o=e.call(this,t)).scheduler=r,o.delay=i,o}return g(n,[{key:"scheduleMessage",value:function(t){this.destination.add(this.scheduler.schedule(n.dispatch,this.delay,new z(t,this.destination)))}},{key:"_next",value:function(t){this.scheduleMessage($.createNext(t))}},{key:"_error",value:function(t){this.scheduleMessage($.createError(t)),this.unsubscribe()}},{key:"_complete",value:function(){this.scheduleMessage($.createComplete()),this.unsubscribe()}}],[{key:"dispatch",value:function(t){var e=t.notification,n=t.destination;e.observe(n),this.unsubscribe()}}]),n}(k),z=function t(e,n){p(this,t),this.notification=e,this.destination=n},J=function(t){s(n,t);var e=u(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.POSITIVE_INFINITY,i=arguments.length>2?arguments[2]:void 0;return p(this,n),(t=e.call(this)).scheduler=i,t._events=[],t._infiniteTimeWindow=!1,t._bufferSize=r<1?1:r,t._windowTime=o<1?1:o,o===Number.POSITIVE_INFINITY?(t._infiniteTimeWindow=!0,t.next=t.nextInfiniteTimeWindow):t.next=t.nextTimeWindow,t}return g(n,[{key:"nextInfiniteTimeWindow",value:function(t){if(!this.isStopped){var e=this._events;e.push(t),e.length>this._bufferSize&&e.shift()}i(f(n.prototype),"next",this).call(this,t)}},{key:"nextTimeWindow",value:function(t){this.isStopped||(this._events.push(new G(this._getNow(),t)),this._trimBufferThenGetEvents()),i(f(n.prototype),"next",this).call(this,t)}},{key:"_subscribe",value:function(t){var e,n=this._infiniteTimeWindow,r=n?this._events:this._trimBufferThenGetEvents(),o=this.scheduler,i=r.length;if(this.closed)throw new x;if(this.isStopped||this.hasError?e=w.EMPTY:(this.observers.push(t),e=new P(this,t)),o&&t.add(t=new Y(t,o)),n)for(var s=0;s<i&&!t.closed;s++)t.next(r[s]);else for(var c=0;c<i&&!t.closed;c++)t.next(r[c].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),e}},{key:"_getNow",value:function(){return(this.scheduler||M).now()}},{key:"_trimBufferThenGetEvents",value:function(){for(var t=this._getNow(),e=this._bufferSize,n=this._windowTime,r=this._events,o=r.length,i=0;i<o&&!(t-r[i].time<n);)i++;return o>e&&(i=Math.max(i,o-e)),i>0&&r.splice(0,i),r}}]),n}(D),G=function t(e,n){p(this,t),this.time=e,this.value=n},X=function(){function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t}();function K(t){return function(e){return 0===t?W():e.lift(new Q(t))}}var Q=function(){function t(e){if(p(this,t),this.total=e,this.total<0)throw new X}return g(t,[{key:"call",value:function(t,e){return e.subscribe(new Z(t,this.total))}}]),t}(),Z=function(t){s(n,t);var e=u(n);function n(t,r){var o;return p(this,n),(o=e.call(this,t)).total=r,o.count=0,o}return g(n,[{key:"_next",value:function(t){var e=this.total,n=++this.count;n<=e&&(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))}}]),n}(k);function tt(t,e){var n=function(e){return Object.assign({type:t,_isMessage:!0},e)};return n.type=t,n}var et=tt("INIT"),nt=tt("INIT_SUCCESS"),rt=new(function(){function t(){p(this,t),this.initSuccess$=new J(1),this.messages$=new D}return g(t,[{key:"start",value:function(){var t=this;addEventListener("message",function(e){var n=e.data;n.type===et.type?t.messages$.next(n):t.initSuccess$.pipe(K(1)).subscribe(function(){return t.messages$.next(n)})})}},{key:"postMessage",value:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){postMessage(t),t.type===nt.type&&this.initSuccess$.next()})}]),t}());rt.start();var ot=[];function it(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new st(t,e))}}var st=function(){function t(e,n){p(this,t),this.project=e,this.thisArg=n}return g(t,[{key:"call",value:function(t,e){return e.subscribe(new ct(t,this.project,this.thisArg))}}]),t}(),ct=function(t){s(n,t);var e=u(n);function n(t,r,o){var i;return p(this,n),(i=e.call(this,t)).project=r,i.count=0,i.thisArg=o||l(i),i}return g(n,[{key:"_next",value:function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(e)}}]),n}(k),ut=function(t){s(n,t);var e=u(n);function n(){return p(this,n),e.apply(this,arguments)}return g(n,[{key:"notifyNext",value:function(t,e,n,r,o){this.destination.next(e)}},{key:"notifyError",value:function(t,e){this.destination.error(t)}},{key:"notifyComplete",value:function(t){this.destination.complete()}}]),n}(k),at=function(t){s(n,t);var e=u(n);function n(t,r,o){var i;return p(this,n),(i=e.call(this)).parent=t,i.outerValue=r,i.outerIndex=o,i.index=0,i}return g(n,[{key:"_next",value:function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)}},{key:"_error",value:function(t){this.parent.notifyError(t,this),this.unsubscribe()}},{key:"_complete",value:function(){this.parent.notifyComplete(this),this.unsubscribe()}}]),n}(k),lt="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",ht=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function ft(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var pt=function(t){if(t&&"function"==typeof t[C])return function(t){return function(e){var n=t[C]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(e)}}(t);if(ht(t))return q(t);if(ft(t))return function(t){return function(e){return t.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,a),e}}(t);if(t&&"function"==typeof t[lt])return function(t){return function(e){for(var n=t[lt]();;){var r=void 0;try{r=n.next()}catch(o){return e.error(o),e}if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof n.return&&e.add(function(){n.return&&n.return()}),e}}(t);var e="You provided ".concat(v(t)?"an invalid object":"'".concat(t,"'")," where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.");throw new TypeError(e)};function dt(t,e,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new at(t,n,r);if(!o.closed)return e instanceof T?e.subscribe(o):pt(e)(o)}var gt=function(){function t(e,n){p(this,t),this.observables=e,this.project=n}return g(t,[{key:"call",value:function(t,e){return e.subscribe(new vt(t,this.observables,this.project))}}]),t}(),vt=function(t){s(r,t);var e=u(r);function r(t,n,o){var i;p(this,r),(i=e.call(this,t)).observables=n,i.project=o,i.toRespond=[];var s=n.length;i.values=new Array(s);for(var c=0;c<s;c++)i.toRespond.push(c);for(var u=0;u<s;u++)i.add(dt(l(i),n[u],void 0,u));return i}return g(r,[{key:"notifyNext",value:function(t,e,n){this.values[n]=e;var r=this.toRespond;if(r.length>0){var o=r.indexOf(n);-1!==o&&r.splice(o,1)}}},{key:"notifyComplete",value:function(){}},{key:"_next",value:function(t){if(0===this.toRespond.length){var e=[t].concat(n(this.values));this.project?this._tryProject(e):this.destination.next(e)}}},{key:"_tryProject",value:function(t){var e;try{e=this.project.apply(this,t)}catch(n){return void this.destination.error(n)}this.destination.next(e)}}]),r}(ut);function bt(t,e){return e?function(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[C]}(t))return function(t,e){return new T(function(n){var r=new w;return r.add(e.schedule(function(){var o=t[C]();r.add(o.subscribe({next:function(t){r.add(e.schedule(function(){return n.next(t)}))},error:function(t){r.add(e.schedule(function(){return n.error(t)}))},complete:function(){r.add(e.schedule(function(){return n.complete()}))}}))})),r})}(t,e);if(ft(t))return function(t,e){return new T(function(n){var r=new w;return r.add(e.schedule(function(){return t.then(function(t){r.add(e.schedule(function(){n.next(t),r.add(e.schedule(function(){return n.complete()}))}))},function(t){r.add(e.schedule(function(){return n.error(t)}))})})),r})}(t,e);if(ht(t))return L(t,e);if(function(t){return t&&"function"==typeof t[lt]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new T(function(n){var r,o=new w;return o.add(function(){r&&"function"==typeof r.return&&r.return()}),o.add(e.schedule(function(){r=t[lt](),o.add(e.schedule(function(){if(!n.closed){var t,e;try{var o=r.next();t=o.value,e=o.done}catch(o){return void n.error(o)}e?n.complete():(n.next(t),this.schedule())}}))})),o})}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}(t,e):t instanceof T?t:new T(pt(t))}var yt=function(t){s(n,t);var e=u(n);function n(t){var r;return p(this,n),(r=e.call(this)).parent=t,r}return g(n,[{key:"_next",value:function(t){this.parent.notifyNext(t)}},{key:"_error",value:function(t){this.parent.notifyError(t),this.unsubscribe()}},{key:"_complete",value:function(){this.parent.notifyComplete(),this.unsubscribe()}}]),n}(k),wt=function(t){s(n,t);var e=u(n);function n(){return p(this,n),e.apply(this,arguments)}return g(n,[{key:"notifyNext",value:function(t){this.destination.next(t)}},{key:"notifyError",value:function(t){this.destination.error(t)}},{key:"notifyComplete",value:function(){this.destination.complete()}}]),n}(k);function mt(t,e){if(!e.closed){if(t instanceof T)return t.subscribe(e);var n;try{n=pt(t)(e)}catch(r){e.error(r)}return n}}function St(t,e){return"function"==typeof e?function(n){return n.pipe(St(function(n,r){return bt(t(n,r)).pipe(it(function(t,o){return e(n,t,r,o)}))}))}:function(e){return e.lift(new kt(t))}}var kt=function(){function t(e){p(this,t),this.project=e}return g(t,[{key:"call",value:function(t,e){return e.subscribe(new Et(t,this.project))}}]),t}(),Et=function(t){s(n,t);var e=u(n);function n(t,r){var o;return p(this,n),(o=e.call(this,t)).project=r,o.index=0,o}return g(n,[{key:"_next",value:function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(r){return void this.destination.error(r)}this._innerSub(e)}},{key:"_innerSub",value:function(t){var e=this.innerSubscription;e&&e.unsubscribe();var n=new yt(this),r=this.destination;r.add(n),this.innerSubscription=mt(t,n),this.innerSubscription!==n&&r.add(this.innerSubscription)}},{key:"_complete",value:function(){var t=this.innerSubscription;(!t||t.closed)&&i(f(n.prototype),"_complete",this).call(this),this.unsubscribe()}},{key:"_unsubscribe",value:function(){this.innerSubscription=void 0}},{key:"notifyComplete",value:function(){this.innerSubscription=void 0,this.isStopped&&i(f(n.prototype),"_complete",this).call(this)}},{key:"notifyNext",value:function(t){this.destination.next(t)}}]),n}(wt);function Ct(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return"function"==typeof e?function(r){return r.pipe(Ct(function(n,r){return bt(t(n,r)).pipe(it(function(t,o){return e(n,t,r,o)}))},n))}:("number"==typeof e&&(n=e),function(e){return e.lift(new _t(t,n))})}var _t=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.POSITIVE_INFINITY;p(this,t),this.project=e,this.concurrent=n}return g(t,[{key:"call",value:function(t,e){return e.subscribe(new Tt(t,this.project,this.concurrent))}}]),t}(),Tt=function(t){s(n,t);var e=u(n);function n(t,r){var o,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return p(this,n),(o=e.call(this,t)).project=r,o.concurrent=i,o.hasCompleted=!1,o.buffer=[],o.active=0,o.index=0,o}return g(n,[{key:"_next",value:function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)}},{key:"_tryNext",value:function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(e)}},{key:"_innerSub",value:function(t){var e=new yt(this),n=this.destination;n.add(e);var r=mt(t,e);r!==e&&n.add(r)}},{key:"_complete",value:function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}},{key:"notifyNext",value:function(t){this.destination.next(t)}},{key:"notifyComplete",value:function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}]),n}(wt);function It(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY;return Ct(_,t)}function xt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=Number.POSITIVE_INFINITY,o=null,i=e[e.length-1];return F(i)?(o=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(r=e.pop())):"number"==typeof i&&(r=e.pop()),null===o&&1===e.length&&e[0]instanceof T?e[0]:It(r)(U(e,o))}function Pt(t,e){return function(n){return n.lift(new Ot(t,e))}}var Ot=function(){function t(e,n){p(this,t),this.predicate=e,this.thisArg=n}return g(t,[{key:"call",value:function(t,e){return e.subscribe(new Dt(t,this.predicate,this.thisArg))}}]),t}(),Dt=function(t){s(n,t);var e=u(n);function n(t,r,o){var i;return p(this,n),(i=e.call(this,t)).predicate=r,i.thisArg=o,i.count=0,i}return g(n,[{key:"_next",value:function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}e&&this.destination.next(t)}}]),n}(k);function jt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Pt(function(t){return e.some(function(e){return"string"==typeof e?e===t.type:e.type===t.type})})}function Rt(){}var Nt=function(){function t(e,n,r){p(this,t),this.nextOrObserver=e,this.error=n,this.complete=r}return g(t,[{key:"call",value:function(t,e){return e.subscribe(new At(t,this.nextOrObserver,this.error,this.complete))}}]),t}(),At=function(t){s(n,t);var e=u(n);function n(t,o,i,s){var c;return p(this,n),(c=e.call(this,t))._tapNext=Rt,c._tapError=Rt,c._tapComplete=Rt,c._tapError=i||Rt,c._tapComplete=s||Rt,r(o)?(c._context=l(c),c._tapNext=o):o&&(c._context=o,c._tapNext=o.next||Rt,c._tapError=o.error||Rt,c._tapComplete=o.complete||Rt),c}return g(n,[{key:"_next",value:function(t){try{this._tapNext.call(this._context,t)}catch(e){return void this.destination.error(e)}this.destination.next(t)}},{key:"_error",value:function(t){try{this._tapError.call(this._context,t)}catch(e){return void this.destination.error(e)}this.destination.error(t)}},{key:"_complete",value:function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()}}]),n}(k),Mt=[];function Ht(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{postMessage:!0},n=t(rt.messages$);e.postMessage&&(n=n.pipe(function(t,e,n){return function(e){return e.lift(new Nt(t,void 0,void 0))}}(function(t){rt.postMessage(t)}))),Mt.push(n.subscribe())}var Wt=function(){function t(e){p(this,t),this.value=e}return g(t,[{key:"call",value:function(t,e){return e.subscribe(new Ft(t,this.value))}}]),t}(),Ft=function(t){s(n,t);var e=u(n);function n(t,r){var o;return p(this,n),(o=e.call(this,t)).value=r,o}return g(n,[{key:"_next",value:function(t){this.destination.next(this.value)}}]),n}(k),qt={startMonitoring:tt("startMonitoring"),stopMonitoring:tt("stopMonitoring")},Lt={timePointReceive:tt("timePointReceive")},Ut=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Bt=function(t){function e(e,n){var r=this,o=this.constructor.prototype;return(r=t.call(this,e)||this).statusCode=n,r.__proto__=o,r}return Ut(e,t),e}(Error),Vt=function(t){function e(e){void 0===e&&(e="A timeout occurred.");var n=this,r=this.constructor.prototype;return(n=t.call(this,e)||this).__proto__=r,n}return Ut(e,t),e}(Error),$t=function(t){function e(e){void 0===e&&(e="An abort occurred.");var n=this,r=this.constructor.prototype;return(n=t.call(this,e)||this).__proto__=r,n}return Ut(e,t),e}(Error),Yt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},zt=function(t,e,n){this.statusCode=t,this.statusText=e,this.content=n},Jt=function(){function t(){}return t.prototype.get=function(t,e){return this.send(Yt({},e,{method:"GET",url:t}))},t.prototype.post=function(t,e){return this.send(Yt({},e,{method:"POST",url:t}))},t.prototype.delete=function(t,e){return this.send(Yt({},e,{method:"DELETE",url:t}))},t.prototype.getCookieString=function(t){return""},t}(),Gt=(function(t){t[t.Trace=0]="Trace",t[t.Debug=1]="Debug",t[t.Information=2]="Information",t[t.Warning=3]="Warning",t[t.Error=4]="Error",t[t.Critical=5]="Critical",t[t.None=6]="None"}(Gt||(Gt={})),Gt),Xt=function(){function t(){}return t.prototype.log=function(t,e){},t.instance=new t,t}(),Kt=function(){function t(){}return t.isRequired=function(t,e){if(null==t)throw new Error("The '"+e+"' argument is required.")},t.isIn=function(t,e,n){if(!(t in e))throw new Error("Unknown "+n+" value: "+t+".")},t}(),Qt=function(){function t(){}return Object.defineProperty(t,"isBrowser",{get:function(){return"object"==typeof window},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isWebWorker",{get:function(){return"object"==typeof self&&"importScripts"in self},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isNode",{get:function(){return!this.isBrowser&&!this.isWebWorker},enumerable:!0,configurable:!0}),t}();function Zt(t,e){var n="";return te(t)?(n="Binary data of length "+t.byteLength,e&&(n+=". Content: '"+function(t){var e=new Uint8Array(t),n="";return e.forEach(function(t){n+="0x"+(t<16?"0":"")+t.toString(16)+" "}),n.substr(0,n.length-1)}(t)+"'")):"string"==typeof t&&(n="String data of length "+t.length,e&&(n+=". Content: '"+t+"'")),n}function te(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function ee(t,e,n,r,o,i,s){return function(t,e,n,r){return new(n||(n=Promise))(function(e,o){function i(t){try{c(r.next(t))}catch(e){o(e)}}function s(t){try{c(r.throw(t))}catch(e){o(e)}}function c(t){t.done?e(t.value):new n(function(e){e(t.value)}).then(i,s)}c((r=r.apply(t,[])).next())})}(this,0,void 0,function(){var c,u,a,l,h;return function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,function(f){switch(f.label){case 0:return o?[4,o()]:[3,2];case 1:(a=f.sent())&&((c={}).Authorization="Bearer "+a,u=c),f.label=2;case 2:return t.log(Gt.Trace,"("+e+" transport) sending data. "+Zt(i,s)+"."),l=te(i)?"arraybuffer":"text",[4,n.post(r,{content:i,headers:u,responseType:l})];case 3:return h=f.sent(),t.log(Gt.Trace,"("+e+" transport) request complete. Response status: "+h.statusCode+"."),[2]}})})}var ne,re=function(){function t(t,e){this.subject=t,this.observer=e}return t.prototype.dispose=function(){var t=this.subject.observers.indexOf(this.observer);t>-1&&this.subject.observers.splice(t,1),0===this.subject.observers.length&&this.subject.cancelCallback&&this.subject.cancelCallback().catch(function(t){})},t}(),oe=function(){function t(t){this.minimumLogLevel=t,this.outputConsole=console}return t.prototype.log=function(t,e){if(t>=this.minimumLogLevel)switch(t){case Gt.Critical:case Gt.Error:this.outputConsole.error("["+(new Date).toISOString()+"] "+Gt[t]+": "+e);break;case Gt.Warning:this.outputConsole.warn("["+(new Date).toISOString()+"] "+Gt[t]+": "+e);break;case Gt.Information:this.outputConsole.info("["+(new Date).toISOString()+"] "+Gt[t]+": "+e);break;default:this.outputConsole.log("["+(new Date).toISOString()+"] "+Gt[t]+": "+e)}},t}(),ie=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),se=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t};if("undefined"==typeof XMLHttpRequest){var ce=require;ne=ce("request")}var ue=function(t){function e(e){var n=t.call(this)||this;if(void 0===ne)throw new Error("The 'request' module could not be loaded.");return n.logger=e,n.cookieJar=ne.jar(),n.request=ne.defaults({jar:n.cookieJar}),n}return ie(e,t),e.prototype.send=function(t){var e=this;return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new $t):new Promise(function(n,r){var o;o=te(t.content)?Buffer.from(t.content):t.content||"";var i=e.request(t.url,{body:o,encoding:"arraybuffer"===t.responseType?null:"utf8",headers:se({"X-Requested-With":"XMLHttpRequest"},t.headers),method:t.method,timeout:t.timeout},function(o,i,s){if(t.abortSignal&&(t.abortSignal.onabort=null),o)return"ETIMEDOUT"===o.code&&(e.logger.log(Gt.Warning,"Timeout from HTTP request."),r(new Vt)),e.logger.log(Gt.Warning,"Error from HTTP request. "+o),void r(o);i.statusCode>=200&&i.statusCode<300?n(new zt(i.statusCode,i.statusMessage||"",s)):r(new Bt(i.statusMessage||"",i.statusCode||0))});t.abortSignal&&(t.abortSignal.onabort=function(){i.abort(),r(new $t)})})},e.prototype.getCookieString=function(t){return this.cookieJar.getCookieString(t)},e}(Jt),ae=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),le=function(t){function e(e){var n=t.call(this)||this;return n.logger=e,n}return ae(e,t),e.prototype.send=function(t){var e=this;return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new $t):t.method?t.url?new Promise(function(n,r){var o=new XMLHttpRequest;o.open(t.method,t.url,!0),o.withCredentials=!0,o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.setRequestHeader("Content-Type","text/plain;charset=UTF-8");var i=t.headers;i&&Object.keys(i).forEach(function(t){o.setRequestHeader(t,i[t])}),t.responseType&&(o.responseType=t.responseType),t.abortSignal&&(t.abortSignal.onabort=function(){o.abort(),r(new $t)}),t.timeout&&(o.timeout=t.timeout),o.onload=function(){t.abortSignal&&(t.abortSignal.onabort=null),o.status>=200&&o.status<300?n(new zt(o.status,o.statusText,o.response||o.responseText)):r(new Bt(o.statusText,o.status))},o.onerror=function(){e.logger.log(Gt.Warning,"Error from HTTP request. "+o.status+": "+o.statusText+"."),r(new Bt(o.statusText,o.status))},o.ontimeout=function(){e.logger.log(Gt.Warning,"Timeout from HTTP request."),r(new Vt)},o.send(t.content||"")}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))},e}(Jt),he=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),fe=function(t){function e(e){var n=t.call(this)||this;return n.httpClient="undefined"!=typeof XMLHttpRequest?new le(e):new ue(e),n}return he(e,t),e.prototype.send=function(t){return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new $t):t.method?t.url?this.httpClient.send(t):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))},e.prototype.getCookieString=function(t){return this.httpClient.getCookieString(t)},e}(Jt),pe=function(){function t(){}return t.write=function(e){return""+e+t.RecordSeparator},t.parse=function(e){if(e[e.length-1]!==t.RecordSeparator)throw new Error("Message is incomplete.");var n=e.split(t.RecordSeparator);return n.pop(),n},t.RecordSeparatorCode=30,t.RecordSeparator=String.fromCharCode(t.RecordSeparatorCode),t}(),de=function(){function t(){}return t.prototype.writeHandshakeRequest=function(t){return pe.write(JSON.stringify(t))},t.prototype.parseHandshakeResponse=function(t){var e,n;if(te(t)||"undefined"!=typeof Buffer&&t instanceof Buffer){var r=new Uint8Array(t);if(-1===(i=r.indexOf(pe.RecordSeparatorCode)))throw new Error("Message is incomplete.");var o=i+1;e=String.fromCharCode.apply(null,r.slice(0,o)),n=r.byteLength>o?r.slice(o).buffer:null}else{var i,s=t;if(-1===(i=s.indexOf(pe.RecordSeparator)))throw new Error("Message is incomplete.");e=s.substring(0,o=i+1),n=s.length>o?s.substring(o):null}var c=pe.parse(e),u=JSON.parse(c[0]);if(u.type)throw new Error("Expected a handshake response from the server.");return[n,u]},t}(),ge=(function(t){t[t.Invocation=1]="Invocation",t[t.StreamItem=2]="StreamItem",t[t.Completion=3]="Completion",t[t.StreamInvocation=4]="StreamInvocation",t[t.CancelInvocation=5]="CancelInvocation",t[t.Ping=6]="Ping",t[t.Close=7]="Close"}(ge||(ge={})),ge),ve=function(){function t(){this.observers=[]}return t.prototype.next=function(t){for(var e=0,n=this.observers;e<n.length;e++)n[e].next(t)},t.prototype.error=function(t){for(var e=0,n=this.observers;e<n.length;e++){var r=n[e];r.error&&r.error(t)}},t.prototype.complete=function(){for(var t=0,e=this.observers;t<e.length;t++){var n=e[t];n.complete&&n.complete()}},t.prototype.subscribe=function(t){return this.observers.push(t),new re(this,t)},t}(),be=function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function s(t){try{u(r.next(t))}catch(e){i(e)}}function c(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(s,c)}u((r=r.apply(t,e||[])).next())})},ye=function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},we=(function(t){t.Disconnected="Disconnected",t.Connecting="Connecting",t.Connected="Connected",t.Disconnecting="Disconnecting",t.Reconnecting="Reconnecting"}(we||(we={})),we),me=function(){function t(t,e,n,r){var o=this;this.nextKeepAlive=0,Kt.isRequired(t,"connection"),Kt.isRequired(e,"logger"),Kt.isRequired(n,"protocol"),this.serverTimeoutInMilliseconds=3e4,this.keepAliveIntervalInMilliseconds=15e3,this.logger=e,this.protocol=n,this.connection=t,this.reconnectPolicy=r,this.handshakeProtocol=new de,this.connection.onreceive=function(t){return o.processIncomingData(t)},this.connection.onclose=function(t){return o.connectionClosed(t)},this.callbacks={},this.methods={},this.closedCallbacks=[],this.reconnectingCallbacks=[],this.reconnectedCallbacks=[],this.invocationId=0,this.receivedHandshakeResponse=!1,this.connectionState=we.Disconnected,this.connectionStarted=!1,this.cachedPingMessage=this.protocol.writeMessage({type:ge.Ping})}return t.create=function(e,n,r,o){return new t(e,n,r,o)},Object.defineProperty(t.prototype,"state",{get:function(){return this.connectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"connectionId",{get:function(){return this.connection&&this.connection.connectionId||null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"baseUrl",{get:function(){return this.connection.baseUrl||""},set:function(t){if(this.connectionState!==we.Disconnected&&this.connectionState!==we.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!t)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=t},enumerable:!0,configurable:!0}),t.prototype.start=function(){return this.startPromise=this.startWithStateTransitions(),this.startPromise},t.prototype.startWithStateTransitions=function(){return be(this,void 0,void 0,function(){var t;return ye(this,function(e){switch(e.label){case 0:if(this.connectionState!==we.Disconnected)return[2,Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."))];this.connectionState=we.Connecting,this.logger.log(Gt.Debug,"Starting HubConnection."),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.startInternal()];case 2:return e.sent(),this.connectionState=we.Connected,this.connectionStarted=!0,this.logger.log(Gt.Debug,"HubConnection connected successfully."),[3,4];case 3:return t=e.sent(),this.connectionState=we.Disconnected,this.logger.log(Gt.Debug,"HubConnection failed to start successfully because of error '"+t+"'."),[2,Promise.reject(t)];case 4:return[2]}})})},t.prototype.startInternal=function(){return be(this,void 0,void 0,function(){var t,e,n,r=this;return ye(this,function(o){switch(o.label){case 0:return this.stopDuringStartError=void 0,this.receivedHandshakeResponse=!1,t=new Promise(function(t,e){r.handshakeResolver=t,r.handshakeRejecter=e}),[4,this.connection.start(this.protocol.transferFormat)];case 1:o.sent(),o.label=2;case 2:return o.trys.push([2,5,,7]),e={protocol:this.protocol.name,version:this.protocol.version},this.logger.log(Gt.Debug,"Sending handshake request."),[4,this.sendMessage(this.handshakeProtocol.writeHandshakeRequest(e))];case 3:return o.sent(),this.logger.log(Gt.Information,"Using HubProtocol '"+this.protocol.name+"'."),this.cleanupTimeout(),this.resetTimeoutPeriod(),this.resetKeepAliveInterval(),[4,t];case 4:if(o.sent(),this.stopDuringStartError)throw this.stopDuringStartError;return[3,7];case 5:return n=o.sent(),this.logger.log(Gt.Debug,"Hub handshake failed with error '"+n+"' during start(). Stopping HubConnection."),this.cleanupTimeout(),this.cleanupPingTimer(),[4,this.connection.stop(n)];case 6:throw o.sent(),n;case 7:return[2]}})})},t.prototype.stop=function(){return be(this,void 0,void 0,function(){var t;return ye(this,function(e){switch(e.label){case 0:return t=this.startPromise,this.stopPromise=this.stopInternal(),[4,this.stopPromise];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,4,,5]),[4,t];case 3:case 4:return e.sent(),[3,5];case 5:return[2]}})})},t.prototype.stopInternal=function(t){return this.connectionState===we.Disconnected?(this.logger.log(Gt.Debug,"Call to HubConnection.stop("+t+") ignored because it is already in the disconnected state."),Promise.resolve()):this.connectionState===we.Disconnecting?(this.logger.log(Gt.Debug,"Call to HttpConnection.stop("+t+") ignored because the connection is already in the disconnecting state."),this.stopPromise):(this.connectionState=we.Disconnecting,this.logger.log(Gt.Debug,"Stopping HubConnection."),this.reconnectDelayHandle?(this.logger.log(Gt.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this.reconnectDelayHandle),this.reconnectDelayHandle=void 0,this.completeClose(),Promise.resolve()):(this.cleanupTimeout(),this.cleanupPingTimer(),this.stopDuringStartError=t||new Error("The connection was stopped before the hub handshake could complete."),this.connection.stop(t)))},t.prototype.stream=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o,i=this.replaceStreamingParams(n),s=i[0],c=i[1],u=this.createStreamInvocation(t,n,c),a=new ve;return a.cancelCallback=function(){var t=e.createCancelInvocation(u.invocationId);return delete e.callbacks[u.invocationId],o.then(function(){return e.sendWithProtocol(t)})},this.callbacks[u.invocationId]=function(t,e){e?a.error(e):t&&(t.type===ge.Completion?t.error?a.error(new Error(t.error)):a.complete():a.next(t.item))},o=this.sendWithProtocol(u).catch(function(t){a.error(t),delete e.callbacks[u.invocationId]}),this.launchStreams(s,o),a},t.prototype.sendMessage=function(t){return this.resetKeepAliveInterval(),this.connection.send(t)},t.prototype.sendWithProtocol=function(t){return this.sendMessage(this.protocol.writeMessage(t))},t.prototype.send=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=this.replaceStreamingParams(e),o=r[0],i=r[1],s=this.sendWithProtocol(this.createInvocation(t,e,!0,i));return this.launchStreams(o,s),s},t.prototype.invoke=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=this.replaceStreamingParams(n),i=o[0],s=o[1],c=this.createInvocation(t,n,!1,s),u=new Promise(function(t,n){e.callbacks[c.invocationId]=function(e,r){r?n(r):e&&(e.type===ge.Completion?e.error?n(new Error(e.error)):t(e.result):n(new Error("Unexpected message type: "+e.type)))};var r=e.sendWithProtocol(c).catch(function(t){n(t),delete e.callbacks[c.invocationId]});e.launchStreams(i,r)});return u},t.prototype.on=function(t,e){!t||!e||(t=t.toLowerCase(),this.methods[t]||(this.methods[t]=[]),-1===this.methods[t].indexOf(e)&&this.methods[t].push(e))},t.prototype.off=function(t,e){if(t){t=t.toLowerCase();var n=this.methods[t];if(n)if(e){var r=n.indexOf(e);-1!==r&&(n.splice(r,1),0===n.length&&delete this.methods[t])}else delete this.methods[t]}},t.prototype.onclose=function(t){t&&this.closedCallbacks.push(t)},t.prototype.onreconnecting=function(t){t&&this.reconnectingCallbacks.push(t)},t.prototype.onreconnected=function(t){t&&this.reconnectedCallbacks.push(t)},t.prototype.processIncomingData=function(t){if(this.cleanupTimeout(),this.receivedHandshakeResponse||(t=this.processHandshakeResponse(t),this.receivedHandshakeResponse=!0),t)for(var e=0,n=this.protocol.parseMessages(t,this.logger);e<n.length;e++){var r=n[e];switch(r.type){case ge.Invocation:this.invokeClientMethod(r);break;case ge.StreamItem:case ge.Completion:var o=this.callbacks[r.invocationId];o&&(r.type===ge.Completion&&delete this.callbacks[r.invocationId],o(r));break;case ge.Ping:break;case ge.Close:this.logger.log(Gt.Information,"Close message received from server.");var i=r.error?new Error("Server returned an error on close: "+r.error):void 0;!0===r.allowReconnect?this.connection.stop(i):this.stopPromise=this.stopInternal(i);break;default:this.logger.log(Gt.Warning,"Invalid message type: "+r.type+".")}}this.resetTimeoutPeriod()},t.prototype.processHandshakeResponse=function(t){var e,n,r,o;try{r=(e=this.handshakeProtocol.parseHandshakeResponse(t))[0],n=e[1]}catch(s){this.logger.log(Gt.Error,o="Error parsing handshake response: "+s);var i=new Error(o);throw this.handshakeRejecter(i),i}if(n.error)throw this.logger.log(Gt.Error,o="Server returned handshake error: "+n.error),i=new Error(o),this.handshakeRejecter(i),i;return this.logger.log(Gt.Debug,"Server handshake complete."),this.handshakeResolver(),r},t.prototype.resetKeepAliveInterval=function(){this.connection.features.inherentKeepAlive||(this.nextKeepAlive=(new Date).getTime()+this.keepAliveIntervalInMilliseconds,this.cleanupPingTimer())},t.prototype.resetTimeoutPeriod=function(){var t=this;if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this.timeoutHandle=setTimeout(function(){return t.serverTimeout()},this.serverTimeoutInMilliseconds),void 0!==this.pingServerHandle))){var e=this.nextKeepAlive-(new Date).getTime();e<0&&(e=0),this.pingServerHandle=setTimeout(function(){return be(t,void 0,void 0,function(){return ye(this,function(t){switch(t.label){case 0:if(this.connectionState!==we.Connected)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.sendMessage(this.cachedPingMessage)];case 2:return t.sent(),[3,4];case 3:return t.sent(),this.cleanupPingTimer(),[3,4];case 4:return[2]}})})},e)}},t.prototype.serverTimeout=function(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))},t.prototype.invokeClientMethod=function(t){var e=this,n=this.methods[t.target.toLowerCase()];if(n){try{n.forEach(function(n){return n.apply(e,t.arguments)})}catch(o){this.logger.log(Gt.Error,"A callback for the method "+t.target.toLowerCase()+" threw error '"+o+"'.")}if(t.invocationId){var r="Server requested a response, which is not supported in this version of the client.";this.logger.log(Gt.Error,r),this.stopPromise=this.stopInternal(new Error(r))}}else this.logger.log(Gt.Warning,"No client method with the name '"+t.target+"' found.")},t.prototype.connectionClosed=function(t){this.logger.log(Gt.Debug,"HubConnection.connectionClosed("+t+") called while in state "+this.connectionState+"."),this.stopDuringStartError=this.stopDuringStartError||t||new Error("The underlying connection was closed before the hub handshake could complete."),this.handshakeResolver&&this.handshakeResolver(),this.cancelCallbacksWithError(t||new Error("Invocation canceled due to the underlying connection being closed.")),this.cleanupTimeout(),this.cleanupPingTimer(),this.connectionState===we.Disconnecting?this.completeClose(t):this.connectionState===we.Connected&&this.reconnectPolicy?this.reconnect(t):this.connectionState===we.Connected&&this.completeClose(t)},t.prototype.completeClose=function(t){var e=this;if(this.connectionStarted){this.connectionState=we.Disconnected,this.connectionStarted=!1;try{this.closedCallbacks.forEach(function(n){return n.apply(e,[t])})}catch(n){this.logger.log(Gt.Error,"An onclose callback called with error '"+t+"' threw error '"+n+"'.")}}},t.prototype.reconnect=function(t){return be(this,void 0,void 0,function(){var e,n,r,o,i,s=this;return ye(this,function(c){switch(c.label){case 0:if(e=Date.now(),n=0,r=void 0!==t?t:new Error("Attempting to reconnect due to a unknown error."),null===(o=this.getNextRetryDelay(n++,0,r)))return this.logger.log(Gt.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this.completeClose(t),[2];if(this.connectionState=we.Reconnecting,this.logger.log(Gt.Information,t?"Connection reconnecting because of error '"+t+"'.":"Connection reconnecting."),this.onreconnecting){try{this.reconnectingCallbacks.forEach(function(e){return e.apply(s,[t])})}catch(u){this.logger.log(Gt.Error,"An onreconnecting callback called with error '"+t+"' threw error '"+u+"'.")}if(this.connectionState!==we.Reconnecting)return this.logger.log(Gt.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting."),[2]}c.label=1;case 1:return null===o?[3,7]:(this.logger.log(Gt.Information,"Reconnect attempt number "+n+" will start in "+o+" ms."),[4,new Promise(function(t){s.reconnectDelayHandle=setTimeout(t,o)})]);case 2:if(c.sent(),this.reconnectDelayHandle=void 0,this.connectionState!==we.Reconnecting)return this.logger.log(Gt.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting."),[2];c.label=3;case 3:return c.trys.push([3,5,,6]),[4,this.startInternal()];case 4:if(c.sent(),this.connectionState=we.Connected,this.logger.log(Gt.Information,"HubConnection reconnected successfully."),this.onreconnected)try{this.reconnectedCallbacks.forEach(function(t){return t.apply(s,[s.connection.connectionId])})}catch(u){this.logger.log(Gt.Error,"An onreconnected callback called with connectionId '"+this.connection.connectionId+"; threw error '"+u+"'.")}return[2];case 5:return i=c.sent(),this.logger.log(Gt.Information,"Reconnect attempt failed because of error '"+i+"'."),this.connectionState!==we.Reconnecting?(this.logger.log(Gt.Debug,"Connection moved to the '"+this.connectionState+"' from the reconnecting state during reconnect attempt. Done reconnecting."),this.connectionState===we.Disconnecting&&this.completeClose(),[2]):(r=i instanceof Error?i:new Error(i.toString()),o=this.getNextRetryDelay(n++,Date.now()-e,r),[3,6]);case 6:return[3,1];case 7:return this.logger.log(Gt.Information,"Reconnect retries have been exhausted after "+(Date.now()-e)+" ms and "+n+" failed attempts. Connection disconnecting."),this.completeClose(),[2]}})})},t.prototype.getNextRetryDelay=function(t,e,n){try{return this.reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:e,previousRetryCount:t,retryReason:n})}catch(r){return this.logger.log(Gt.Error,"IRetryPolicy.nextRetryDelayInMilliseconds("+t+", "+e+") threw error '"+r+"'."),null}},t.prototype.cancelCallbacksWithError=function(t){var e=this.callbacks;this.callbacks={},Object.keys(e).forEach(function(n){(0,e[n])(null,t)})},t.prototype.cleanupPingTimer=function(){this.pingServerHandle&&(clearTimeout(this.pingServerHandle),this.pingServerHandle=void 0)},t.prototype.cleanupTimeout=function(){this.timeoutHandle&&clearTimeout(this.timeoutHandle)},t.prototype.createInvocation=function(t,e,n,r){if(n)return{arguments:e,streamIds:r,target:t,type:ge.Invocation};var o=this.invocationId;return this.invocationId++,{arguments:e,invocationId:o.toString(),streamIds:r,target:t,type:ge.Invocation}},t.prototype.launchStreams=function(t,e){var n=this;if(0!==t.length){e||(e=Promise.resolve());var r=function(r){t[r].subscribe({complete:function(){e=e.then(function(){return n.sendWithProtocol(n.createCompletionMessage(r))})},error:function(t){var o;o=t instanceof Error?t.message:t&&t.toString?t.toString():"Unknown error",e=e.then(function(){return n.sendWithProtocol(n.createCompletionMessage(r,o))})},next:function(t){e=e.then(function(){return n.sendWithProtocol(n.createStreamItemMessage(r,t))})}})};for(var o in t)r(o)}},t.prototype.replaceStreamingParams=function(t){for(var e=[],n=[],r=0;r<t.length;r++){var o=t[r];if(this.isObservable(o)){var i=this.invocationId;this.invocationId++,e[i]=o,n.push(i.toString()),t.splice(r,1)}}return[e,n]},t.prototype.isObservable=function(t){return t&&t.subscribe&&"function"==typeof t.subscribe},t.prototype.createStreamInvocation=function(t,e,n){var r=this.invocationId;return this.invocationId++,{arguments:e,invocationId:r.toString(),streamIds:n,target:t,type:ge.StreamInvocation}},t.prototype.createCancelInvocation=function(t){return{invocationId:t,type:ge.CancelInvocation}},t.prototype.createStreamItemMessage=function(t,e){return{invocationId:t,item:e,type:ge.StreamItem}},t.prototype.createCompletionMessage=function(t,e,n){return e?{error:e,invocationId:t,type:ge.Completion}:{invocationId:t,result:n,type:ge.Completion}},t}(),Se=[0,2e3,1e4,3e4,null],ke=function(){function t(t){this.retryDelays=void 0!==t?t.concat([null]):Se}return t.prototype.nextRetryDelayInMilliseconds=function(t){return this.retryDelays[t.previousRetryCount]},t}(),Ee=(function(t){t[t.None=0]="None",t[t.WebSockets=1]="WebSockets",t[t.ServerSentEvents=2]="ServerSentEvents",t[t.LongPolling=4]="LongPolling"}(Ee||(Ee={})),Ee),Ce=(function(t){t[t.Text=1]="Text",t[t.Binary=2]="Binary"}(Ce||(Ce={})),Ce),_e=function(){function t(){this.isAborted=!1,this.onabort=null}return t.prototype.abort=function(){this.isAborted||(this.isAborted=!0,this.onabort&&this.onabort())},Object.defineProperty(t.prototype,"signal",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aborted",{get:function(){return this.isAborted},enumerable:!0,configurable:!0}),t}(),Te=function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function s(t){try{u(r.next(t))}catch(e){i(e)}}function c(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(s,c)}u((r=r.apply(t,e||[])).next())})},Ie=function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},xe=function(){function t(t,e,n,r){this.httpClient=t,this.accessTokenFactory=e,this.logger=n,this.pollAbort=new _e,this.logMessageContent=r,this.running=!1,this.onreceive=null,this.onclose=null}return Object.defineProperty(t.prototype,"pollAborted",{get:function(){return this.pollAbort.aborted},enumerable:!0,configurable:!0}),t.prototype.connect=function(t,e){return Te(this,void 0,void 0,function(){var n,r,o,i;return Ie(this,function(s){switch(s.label){case 0:if(Kt.isRequired(t,"url"),Kt.isRequired(e,"transferFormat"),Kt.isIn(e,Ce,"transferFormat"),this.url=t,this.logger.log(Gt.Trace,"(LongPolling transport) Connecting."),e===Ce.Binary&&"undefined"!=typeof XMLHttpRequest&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");return n={abortSignal:this.pollAbort.signal,headers:{},timeout:1e5},e===Ce.Binary&&(n.responseType="arraybuffer"),[4,this.getAccessToken()];case 1:return r=s.sent(),this.updateHeaderToken(n,r),o=t+"&_="+Date.now(),this.logger.log(Gt.Trace,"(LongPolling transport) polling: "+o+"."),[4,this.httpClient.get(o,n)];case 2:return 200!==(i=s.sent()).statusCode?(this.logger.log(Gt.Error,"(LongPolling transport) Unexpected response code: "+i.statusCode+"."),this.closeError=new Bt(i.statusText||"",i.statusCode),this.running=!1):this.running=!0,this.receiving=this.poll(this.url,n),[2]}})})},t.prototype.getAccessToken=function(){return Te(this,void 0,void 0,function(){return Ie(this,function(t){switch(t.label){case 0:return this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:return[2,t.sent()];case 2:return[2,null]}})})},t.prototype.updateHeaderToken=function(t,e){t.headers||(t.headers={}),e?t.headers.Authorization="Bearer "+e:t.headers.Authorization&&delete t.headers.Authorization},t.prototype.poll=function(t,e){return Te(this,void 0,void 0,function(){var n,r,o,i;return Ie(this,function(s){switch(s.label){case 0:s.trys.push([0,,8,9]),s.label=1;case 1:return this.running?[4,this.getAccessToken()]:[3,7];case 2:n=s.sent(),this.updateHeaderToken(e,n),s.label=3;case 3:return s.trys.push([3,5,,6]),r=t+"&_="+Date.now(),this.logger.log(Gt.Trace,"(LongPolling transport) polling: "+r+"."),[4,this.httpClient.get(r,e)];case 4:return 204===(o=s.sent()).statusCode?(this.logger.log(Gt.Information,"(LongPolling transport) Poll terminated by server."),this.running=!1):200!==o.statusCode?(this.logger.log(Gt.Error,"(LongPolling transport) Unexpected response code: "+o.statusCode+"."),this.closeError=new Bt(o.statusText||"",o.statusCode),this.running=!1):o.content?(this.logger.log(Gt.Trace,"(LongPolling transport) data received. "+Zt(o.content,this.logMessageContent)+"."),this.onreceive&&this.onreceive(o.content)):this.logger.log(Gt.Trace,"(LongPolling transport) Poll timed out, reissuing."),[3,6];case 5:return i=s.sent(),this.running?i instanceof Vt?this.logger.log(Gt.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this.closeError=i,this.running=!1):this.logger.log(Gt.Trace,"(LongPolling transport) Poll errored after shutdown: "+i.message),[3,6];case 6:return[3,1];case 7:return[3,9];case 8:return this.logger.log(Gt.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this.raiseOnClose(),[7];case 9:return[2]}})})},t.prototype.send=function(t){return Te(this,void 0,void 0,function(){return Ie(this,function(e){return this.running?[2,ee(this.logger,"LongPolling",this.httpClient,this.url,this.accessTokenFactory,t,this.logMessageContent)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]})})},t.prototype.stop=function(){return Te(this,void 0,void 0,function(){var t,e;return Ie(this,function(n){switch(n.label){case 0:this.logger.log(Gt.Trace,"(LongPolling transport) Stopping polling."),this.running=!1,this.pollAbort.abort(),n.label=1;case 1:return n.trys.push([1,,5,6]),[4,this.receiving];case 2:return n.sent(),this.logger.log(Gt.Trace,"(LongPolling transport) sending DELETE request to "+this.url+"."),t={headers:{}},[4,this.getAccessToken()];case 3:return e=n.sent(),this.updateHeaderToken(t,e),[4,this.httpClient.delete(this.url,t)];case 4:return n.sent(),this.logger.log(Gt.Trace,"(LongPolling transport) DELETE request sent."),[3,6];case 5:return this.logger.log(Gt.Trace,"(LongPolling transport) Stop finished."),this.raiseOnClose(),[7];case 6:return[2]}})})},t.prototype.raiseOnClose=function(){if(this.onclose){var t="(LongPolling transport) Firing onclose event.";this.closeError&&(t+=" Error: "+this.closeError),this.logger.log(Gt.Trace,t),this.onclose(this.closeError)}},t}(),Pe=function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function s(t){try{u(r.next(t))}catch(e){i(e)}}function c(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(s,c)}u((r=r.apply(t,e||[])).next())})},Oe=function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},De=function(){function t(t,e,n,r,o){this.httpClient=t,this.accessTokenFactory=e,this.logger=n,this.logMessageContent=r,this.eventSourceConstructor=o,this.onreceive=null,this.onclose=null}return t.prototype.connect=function(t,e){return Pe(this,void 0,void 0,function(){var n,r=this;return Oe(this,function(o){switch(o.label){case 0:return Kt.isRequired(t,"url"),Kt.isRequired(e,"transferFormat"),Kt.isIn(e,Ce,"transferFormat"),this.logger.log(Gt.Trace,"(SSE transport) Connecting."),this.url=t,this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(n=o.sent())&&(t+=(t.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(n)),o.label=2;case 2:return[2,new Promise(function(n,o){var i=!1;if(e===Ce.Text){var s;if(Qt.isBrowser||Qt.isWebWorker)s=new r.eventSourceConstructor(t,{withCredentials:!0});else{var c=r.httpClient.getCookieString(t);s=new r.eventSourceConstructor(t,{withCredentials:!0,headers:{Cookie:c}})}try{s.onmessage=function(t){if(r.onreceive)try{r.logger.log(Gt.Trace,"(SSE transport) data received. "+Zt(t.data,r.logMessageContent)+"."),r.onreceive(t.data)}catch(e){return void r.close(e)}},s.onerror=function(t){var e=new Error(t.data||"Error occurred");i?r.close(e):o(e)},s.onopen=function(){r.logger.log(Gt.Information,"SSE connected to "+r.url),r.eventSource=s,i=!0,n()}}catch(u){return void o(u)}}else o(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))})]}})})},t.prototype.send=function(t){return Pe(this,void 0,void 0,function(){return Oe(this,function(e){return this.eventSource?[2,ee(this.logger,"SSE",this.httpClient,this.url,this.accessTokenFactory,t,this.logMessageContent)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]})})},t.prototype.stop=function(){return this.close(),Promise.resolve()},t.prototype.close=function(t){this.eventSource&&(this.eventSource.close(),this.eventSource=void 0,this.onclose&&this.onclose(t))},t}(),je=function(){function t(t,e,n,r,o){this.logger=n,this.accessTokenFactory=e,this.logMessageContent=r,this.webSocketConstructor=o,this.httpClient=t,this.onreceive=null,this.onclose=null}return t.prototype.connect=function(t,e){return function(t,e,n,r){return new(n||(n=Promise))(function(e,o){function i(t){try{c(r.next(t))}catch(e){o(e)}}function s(t){try{c(r.throw(t))}catch(e){o(e)}}function c(t){t.done?e(t.value):new n(function(e){e(t.value)}).then(i,s)}c((r=r.apply(t,[])).next())})}(this,0,void 0,function(){var n,r=this;return function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,function(o){switch(o.label){case 0:return Kt.isRequired(t,"url"),Kt.isRequired(e,"transferFormat"),Kt.isIn(e,Ce,"transferFormat"),this.logger.log(Gt.Trace,"(WebSockets transport) Connecting."),this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(n=o.sent())&&(t+=(t.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(n)),o.label=2;case 2:return[2,new Promise(function(n,o){t=t.replace(/^http/,"ws");var i,s=r.httpClient.getCookieString(t),c=!1;Qt.isNode&&s&&(i=new r.webSocketConstructor(t,void 0,{headers:{Cookie:""+s}})),i||(i=new r.webSocketConstructor(t)),e===Ce.Binary&&(i.binaryType="arraybuffer"),i.onopen=function(e){r.logger.log(Gt.Information,"WebSocket connected to "+t+"."),r.webSocket=i,c=!0,n()},i.onerror=function(t){var e;e="undefined"!=typeof ErrorEvent&&t instanceof ErrorEvent?t.error:new Error("There was an error with the transport."),o(e)},i.onmessage=function(t){r.logger.log(Gt.Trace,"(WebSockets transport) data received. "+Zt(t.data,r.logMessageContent)+"."),r.onreceive&&r.onreceive(t.data)},i.onclose=function(t){var e;c?r.close(t):(e="undefined"!=typeof ErrorEvent&&t instanceof ErrorEvent?t.error:new Error("There was an error with the transport."),o(e))}})]}})})},t.prototype.send=function(t){return this.webSocket&&this.webSocket.readyState===this.webSocketConstructor.OPEN?(this.logger.log(Gt.Trace,"(WebSockets transport) sending data. "+Zt(t,this.logMessageContent)+"."),this.webSocket.send(t),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")},t.prototype.stop=function(){return this.webSocket&&this.close(void 0),Promise.resolve()},t.prototype.close=function(t){this.webSocket&&(this.webSocket.onclose=function(){},this.webSocket.onmessage=function(){},this.webSocket.onerror=function(){},this.webSocket.close(),this.webSocket=void 0),this.logger.log(Gt.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!t||!1!==t.wasClean&&1e3===t.code?this.onclose():this.onclose(new Error("WebSocket closed with status code: "+t.code+" ("+t.reason+").")))},t}(),Re=function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function s(t){try{u(r.next(t))}catch(e){i(e)}}function c(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(s,c)}u((r=r.apply(t,e||[])).next())})},Ne=function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},Ae=null,Me=null;if(Qt.isNode){var He=require;Ae=He("ws"),Me=He("eventsource")}var We=function(){function t(t,e){void 0===e&&(e={}),this.stopPromiseResolver=function(){},this.features={},this.negotiateVersion=1,Kt.isRequired(t,"url"),this.logger=function(t){return void 0===t?new oe(Gt.Information):null===t?Xt.instance:t.log?t:new oe(t)}(e.logger),this.baseUrl=this.resolveUrl(t),(e=e||{}).logMessageContent=e.logMessageContent||!1,Qt.isNode||"undefined"==typeof WebSocket||e.WebSocket?Qt.isNode&&!e.WebSocket&&Ae&&(e.WebSocket=Ae):e.WebSocket=WebSocket,Qt.isNode||"undefined"==typeof EventSource||e.EventSource?Qt.isNode&&!e.EventSource&&void 0!==Me&&(e.EventSource=Me):e.EventSource=EventSource,this.httpClient=e.httpClient||new fe(this.logger),this.connectionState="Disconnected",this.connectionStarted=!1,this.options=e,this.onreceive=null,this.onclose=null}return t.prototype.start=function(t){return Re(this,void 0,void 0,function(){var e;return Ne(this,function(n){switch(n.label){case 0:return Kt.isIn(t=t||Ce.Binary,Ce,"transferFormat"),this.logger.log(Gt.Debug,"Starting connection with transfer format '"+Ce[t]+"'."),"Disconnected"!==this.connectionState?[2,Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."))]:(this.connectionState="Connecting ",this.startInternalPromise=this.startInternal(t),[4,this.startInternalPromise]);case 1:return n.sent(),"Disconnecting"!==this.connectionState?[3,3]:(this.logger.log(Gt.Error,e="Failed to start the HttpConnection before stop() was called."),[4,this.stopPromise]);case 2:return n.sent(),[2,Promise.reject(new Error(e))];case 3:if("Connected"!==this.connectionState)return this.logger.log(Gt.Error,e="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!"),[2,Promise.reject(new Error(e))];n.label=4;case 4:return this.connectionStarted=!0,[2]}})})},t.prototype.send=function(t){return"Connected"!==this.connectionState?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this.sendQueue||(this.sendQueue=new Fe(this.transport)),this.sendQueue.send(t))},t.prototype.stop=function(t){return Re(this,void 0,void 0,function(){var e=this;return Ne(this,function(n){switch(n.label){case 0:return"Disconnected"===this.connectionState?(this.logger.log(Gt.Debug,"Call to HttpConnection.stop("+t+") ignored because the connection is already in the disconnected state."),[2,Promise.resolve()]):"Disconnecting"===this.connectionState?(this.logger.log(Gt.Debug,"Call to HttpConnection.stop("+t+") ignored because the connection is already in the disconnecting state."),[2,this.stopPromise]):(this.connectionState="Disconnecting",this.stopPromise=new Promise(function(t){e.stopPromiseResolver=t}),[4,this.stopInternal(t)]);case 1:return n.sent(),[4,this.stopPromise];case 2:return n.sent(),[2]}})})},t.prototype.stopInternal=function(t){return Re(this,void 0,void 0,function(){var e;return Ne(this,function(n){switch(n.label){case 0:this.stopError=t,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.startInternalPromise];case 2:case 3:return n.sent(),[3,4];case 4:if(!this.transport)return[3,9];n.label=5;case 5:return n.trys.push([5,7,,8]),[4,this.transport.stop()];case 6:return n.sent(),[3,8];case 7:return e=n.sent(),this.logger.log(Gt.Error,"HttpConnection.transport.stop() threw error '"+e+"'."),this.stopConnection(),[3,8];case 8:return this.transport=void 0,[3,10];case 9:this.logger.log(Gt.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed."),n.label=10;case 10:return[2]}})})},t.prototype.startInternal=function(t){return Re(this,void 0,void 0,function(){var e,n,r,o,i,s;return Ne(this,function(c){switch(c.label){case 0:e=this.baseUrl,this.accessTokenFactory=this.options.accessTokenFactory,c.label=1;case 1:return c.trys.push([1,12,,13]),this.options.skipNegotiation?this.options.transport!==Ee.WebSockets?[3,3]:(this.transport=this.constructTransport(Ee.WebSockets),[4,this.startTransport(e,t)]):[3,5];case 2:return c.sent(),[3,4];case 3:throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");case 4:return[3,11];case 5:n=null,r=0,o=function(){var t;return Ne(this,function(o){switch(o.label){case 0:return[4,i.getNegotiationResponse(e)];case 1:if(n=o.sent(),"Disconnecting"===i.connectionState||"Disconnected"===i.connectionState)throw new Error("The connection was stopped during negotiation.");if(n.error)throw new Error(n.error);if(n.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");return n.url&&(e=n.url),n.accessToken&&(t=n.accessToken,i.accessTokenFactory=function(){return t}),r++,[2]}})},i=this,c.label=6;case 6:return[5,o()];case 7:c.sent(),c.label=8;case 8:if(n.url&&r<100)return[3,6];c.label=9;case 9:if(100===r&&n.url)throw new Error("Negotiate redirection limit exceeded.");return[4,this.createTransport(e,this.options.transport,n,t)];case 10:c.sent(),c.label=11;case 11:return this.transport instanceof xe&&(this.features.inherentKeepAlive=!0),"Connecting "===this.connectionState&&(this.logger.log(Gt.Debug,"The HttpConnection connected successfully."),this.connectionState="Connected"),[3,13];case 12:return s=c.sent(),this.logger.log(Gt.Error,"Failed to start the connection: "+s),this.connectionState="Disconnected",this.transport=void 0,this.stopPromiseResolver(),[2,Promise.reject(s)];case 13:return[2]}})})},t.prototype.getNegotiationResponse=function(t){return Re(this,void 0,void 0,function(){var e,n,r,o,i,s,c;return Ne(this,function(u){switch(u.label){case 0:return this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(r=u.sent())&&((e={}).Authorization="Bearer "+r,n=e),u.label=2;case 2:o=this.resolveNegotiateUrl(t),this.logger.log(Gt.Debug,"Sending negotiation request: "+o+"."),u.label=3;case 3:return u.trys.push([3,5,,6]),[4,this.httpClient.post(o,{content:"",headers:n})];case 4:return 200!==(i=u.sent()).statusCode?[2,Promise.reject(new Error("Unexpected status code returned from negotiate "+i.statusCode))]:((!(s=JSON.parse(i.content)).negotiateVersion||s.negotiateVersion<1)&&(s.connectionToken=s.connectionId),[2,s]);case 5:return c=u.sent(),this.logger.log(Gt.Error,"Failed to complete negotiation with the server: "+c),[2,Promise.reject(c)];case 6:return[2]}})})},t.prototype.createConnectUrl=function(t,e){return e?t+(-1===t.indexOf("?")?"?":"&")+"id="+e:t},t.prototype.createTransport=function(t,e,n,r){return Re(this,void 0,void 0,function(){var o,i,s,c,u,a,l,h,f;return Ne(this,function(p){switch(p.label){case 0:return o=this.createConnectUrl(t,n.connectionToken),this.isITransport(e)?(this.logger.log(Gt.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=e,[4,this.startTransport(o,r)]):[3,2];case 1:return p.sent(),this.connectionId=n.connectionId,[2];case 2:i=[],s=n,c=0,u=n.availableTransports||[],p.label=3;case 3:return c<u.length?(l=this.resolveTransportOrError(a=u[c],e,r))instanceof Error?(i.push(a.transport+" failed: "+l),[3,12]):[3,4]:[3,13];case 4:if(!this.isITransport(l))return[3,12];if(this.transport=l,s)return[3,9];p.label=5;case 5:return p.trys.push([5,7,,8]),[4,this.getNegotiationResponse(t)];case 6:return s=p.sent(),[3,8];case 7:return h=p.sent(),[2,Promise.reject(h)];case 8:o=this.createConnectUrl(t,s.connectionToken),p.label=9;case 9:return p.trys.push([9,11,,12]),[4,this.startTransport(o,r)];case 10:return p.sent(),this.connectionId=s.connectionId,[2];case 11:return f=p.sent(),this.logger.log(Gt.Error,"Failed to start the transport '"+a.transport+"': "+f),s=void 0,i.push(a.transport+" failed: "+f),"Connecting "!==this.connectionState?(this.logger.log(Gt.Debug,"Failed to select transport before stop() was called."),[2,Promise.reject(new Error("Failed to select transport before stop() was called."))]):[3,12];case 12:return c++,[3,3];case 13:return i.length>0?[2,Promise.reject(new Error("Unable to connect to the server with any of the available transports. "+i.join(" ")))]:[2,Promise.reject(new Error("None of the transports supported by the client are supported by the server."))]}})})},t.prototype.constructTransport=function(t){switch(t){case Ee.WebSockets:if(!this.options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new je(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.WebSocket);case Ee.ServerSentEvents:if(!this.options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new De(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.EventSource);case Ee.LongPolling:return new xe(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1);default:throw new Error("Unknown transport: "+t+".")}},t.prototype.startTransport=function(t,e){var n=this;return this.transport.onreceive=this.onreceive,this.transport.onclose=function(t){return n.stopConnection(t)},this.transport.connect(t,e)},t.prototype.resolveTransportOrError=function(t,e,n){var r=Ee[t.transport];if(null==r)return this.logger.log(Gt.Debug,"Skipping transport '"+t.transport+"' because it is not supported by this client."),new Error("Skipping transport '"+t.transport+"' because it is not supported by this client.");if(!function(t,e){return!t||0!=(e&t)}(e,r))return this.logger.log(Gt.Debug,"Skipping transport '"+Ee[r]+"' because it was disabled by the client."),new Error("'"+Ee[r]+"' is disabled by the client.");if(!(t.transferFormats.map(function(t){return Ce[t]}).indexOf(n)>=0))return this.logger.log(Gt.Debug,"Skipping transport '"+Ee[r]+"' because it does not support the requested transfer format '"+Ce[n]+"'."),new Error("'"+Ee[r]+"' does not support "+Ce[n]+".");if(r===Ee.WebSockets&&!this.options.WebSocket||r===Ee.ServerSentEvents&&!this.options.EventSource)return this.logger.log(Gt.Debug,"Skipping transport '"+Ee[r]+"' because it is not supported in your environment.'"),new Error("'"+Ee[r]+"' is not supported in your environment.");this.logger.log(Gt.Debug,"Selecting transport '"+Ee[r]+"'.");try{return this.constructTransport(r)}catch(o){return o}},t.prototype.isITransport=function(t){return t&&"object"==typeof t&&"connect"in t},t.prototype.stopConnection=function(t){var e=this;if(this.logger.log(Gt.Debug,"HttpConnection.stopConnection("+t+") called while in state "+this.connectionState+"."),this.transport=void 0,t=this.stopError||t,this.stopError=void 0,"Disconnected"!==this.connectionState)if("Connecting "!==this.connectionState){if("Disconnecting"===this.connectionState&&this.stopPromiseResolver(),t?this.logger.log(Gt.Error,"Connection disconnected with error '"+t+"'."):this.logger.log(Gt.Information,"Connection disconnected."),this.sendQueue&&(this.sendQueue.stop().catch(function(t){e.logger.log(Gt.Error,"TransportSendQueue.stop() threw error '"+t+"'.")}),this.sendQueue=void 0),this.connectionId=void 0,this.connectionState="Disconnected",this.connectionStarted){this.connectionStarted=!1;try{this.onclose&&this.onclose(t)}catch(n){this.logger.log(Gt.Error,"HttpConnection.onclose("+t+") threw error '"+n+"'.")}}}else this.logger.log(Gt.Warning,"Call to HttpConnection.stopConnection("+t+") was ignored because the connection hasn't yet left the in the connecting state.");else this.logger.log(Gt.Debug,"Call to HttpConnection.stopConnection("+t+") was ignored because the connection is already in the disconnected state.")},t.prototype.resolveUrl=function(t){if(0===t.lastIndexOf("https://",0)||0===t.lastIndexOf("http://",0))return t;if(!Qt.isBrowser||!window.document)throw new Error("Cannot resolve '"+t+"'.");var e=window.document.createElement("a");return e.href=t,this.logger.log(Gt.Information,"Normalizing '"+t+"' to '"+e.href+"'."),e.href},t.prototype.resolveNegotiateUrl=function(t){var e=t.indexOf("?"),n=t.substring(0,-1===e?t.length:e);return"/"!==n[n.length-1]&&(n+="/"),n+="negotiate",-1===(n+=-1===e?"":t.substring(e)).indexOf("negotiateVersion")&&(n+=-1===e?"?":"&",n+="negotiateVersion="+this.negotiateVersion),n},t}(),Fe=function(){function t(t){this.transport=t,this.buffer=[],this.executing=!0,this.sendBufferedData=new qe,this.transportResult=new qe,this.sendLoopPromise=this.sendLoop()}return t.prototype.send=function(t){return this.bufferData(t),this.transportResult||(this.transportResult=new qe),this.transportResult.promise},t.prototype.stop=function(){return this.executing=!1,this.sendBufferedData.resolve(),this.sendLoopPromise},t.prototype.bufferData=function(t){if(this.buffer.length&&typeof this.buffer[0]!=typeof t)throw new Error("Expected data to be of type "+typeof this.buffer+" but was of type "+typeof t);this.buffer.push(t),this.sendBufferedData.resolve()},t.prototype.sendLoop=function(){return Re(this,void 0,void 0,function(){var e,n,r;return Ne(this,function(o){switch(o.label){case 0:return[4,this.sendBufferedData.promise];case 1:if(o.sent(),!this.executing)return this.transportResult&&this.transportResult.reject("Connection stopped."),[3,6];this.sendBufferedData=new qe,e=this.transportResult,this.transportResult=void 0,n="string"==typeof this.buffer[0]?this.buffer.join(""):t.concatBuffers(this.buffer),this.buffer.length=0,o.label=2;case 2:return o.trys.push([2,4,,5]),[4,this.transport.send(n)];case 3:return o.sent(),e.resolve(),[3,5];case 4:return r=o.sent(),e.reject(r),[3,5];case 5:return[3,0];case 6:return[2]}})})},t.concatBuffers=function(t){for(var e=t.map(function(t){return t.byteLength}).reduce(function(t,e){return t+e}),n=new Uint8Array(e),r=0,o=0,i=t;o<i.length;o++){var s=i[o];n.set(new Uint8Array(s),r),r+=s.byteLength}return n},t}(),qe=function(){function t(){var t=this;this.promise=new Promise(function(e,n){var r;return t.resolver=(r=[e,n])[0],t.rejecter=r[1],r})}return t.prototype.resolve=function(){this.resolver()},t.prototype.reject=function(t){this.rejecter(t)},t}(),Le=function(){function t(){this.name="json",this.version=1,this.transferFormat=Ce.Text}return t.prototype.parseMessages=function(t,e){if("string"!=typeof t)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!t)return[];null===e&&(e=Xt.instance);for(var n=[],r=0,o=pe.parse(t);r<o.length;r++){var i=JSON.parse(o[r]);if("number"!=typeof i.type)throw new Error("Invalid payload.");switch(i.type){case ge.Invocation:this.isInvocationMessage(i);break;case ge.StreamItem:this.isStreamItemMessage(i);break;case ge.Completion:this.isCompletionMessage(i);break;case ge.Ping:case ge.Close:break;default:e.log(Gt.Information,"Unknown message type '"+i.type+"' ignored.");continue}n.push(i)}return n},t.prototype.writeMessage=function(t){return pe.write(JSON.stringify(t))},t.prototype.isInvocationMessage=function(t){this.assertNotEmptyString(t.target,"Invalid payload for Invocation message."),void 0!==t.invocationId&&this.assertNotEmptyString(t.invocationId,"Invalid payload for Invocation message.")},t.prototype.isStreamItemMessage=function(t){if(this.assertNotEmptyString(t.invocationId,"Invalid payload for StreamItem message."),void 0===t.item)throw new Error("Invalid payload for StreamItem message.")},t.prototype.isCompletionMessage=function(t){if(t.result&&t.error)throw new Error("Invalid payload for Completion message.");!t.result&&t.error&&this.assertNotEmptyString(t.error,"Invalid payload for Completion message."),this.assertNotEmptyString(t.invocationId,"Invalid payload for Completion message.")},t.prototype.assertNotEmptyString=function(t,e){if("string"!=typeof t||""===t)throw new Error(e)},t}(),Ue=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},Be={trace:Gt.Trace,debug:Gt.Debug,info:Gt.Information,information:Gt.Information,warn:Gt.Warning,warning:Gt.Warning,error:Gt.Error,critical:Gt.Critical,none:Gt.None},Ve=function(){function t(){}return t.prototype.configureLogging=function(t){if(Kt.isRequired(t,"logging"),function(t){return void 0!==t.log}(t))this.logger=t;else if("string"==typeof t){var e=function(t){var e=Be[t.toLowerCase()];if(void 0!==e)return e;throw new Error("Unknown log level: "+t)}(t);this.logger=new oe(e)}else this.logger=new oe(t);return this},t.prototype.withUrl=function(t,e){return Kt.isRequired(t,"url"),this.url=t,this.httpConnectionOptions=Ue({},this.httpConnectionOptions,"object"==typeof e?e:{transport:e}),this},t.prototype.withHubProtocol=function(t){return Kt.isRequired(t,"protocol"),this.protocol=t,this},t.prototype.withAutomaticReconnect=function(t){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return this.reconnectPolicy=t?Array.isArray(t)?new ke(t):t:new ke,this},t.prototype.build=function(){var t=this.httpConnectionOptions||{};if(void 0===t.logger&&(t.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");var e=new We(this.url,t);return me.create(e,this.logger||Xt.instance,this.protocol||new Le,this.reconnectPolicy)},t}(),$e=new A(R);function Ye(t){return!d(t)&&t-parseFloat(t)+1>=0}function ze(t){var e=t.index,n=t.period,r=t.subscriber;if(r.next(e),!r.closed){if(-1===n)return r.complete();t.index=e+1,this.schedule(t,n)}}var Je=function(){function t(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return t.prototype=Object.create(Error.prototype),t}();function Ge(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(e){return e.lift(new Xe(t))}}var Xe=function(){function t(e){p(this,t),this.defaultValue=e}return g(t,[{key:"call",value:function(t,e){return e.subscribe(new Ke(t,this.defaultValue))}}]),t}(),Ke=function(t){s(n,t);var e=u(n);function n(t,r){var o;return p(this,n),(o=e.call(this,t)).defaultValue=r,o.isEmpty=!0,o}return g(n,[{key:"_next",value:function(t){this.isEmpty=!1,this.destination.next(t)}},{key:"_complete",value:function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}]),n}(k);function Qe(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:en;return function(e){return e.lift(new Ze(t))}}var Ze=function(){function t(e){p(this,t),this.errorFactory=e}return g(t,[{key:"call",value:function(t,e){return e.subscribe(new tn(t,this.errorFactory))}}]),t}(),tn=function(t){s(n,t);var e=u(n);function n(t,r){var o;return p(this,n),(o=e.call(this,t)).errorFactory=r,o.hasValue=!1,o}return g(n,[{key:"_next",value:function(t){this.hasValue=!0,this.destination.next(t)}},{key:"_complete",value:function(){if(this.hasValue)return this.destination.complete();var t;try{t=this.errorFactory()}catch(e){t=e}this.destination.error(t)}}]),n}(k);function en(){return new Je}function nn(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?Pt(function(e,n){return t(e,n,r)}):_,K(1),n?Ge(e):Qe(function(){return new Je}))}}var rn=function(){function t(e){p(this,t),this.selector=e}return g(t,[{key:"call",value:function(t,e){return e.subscribe(new on(t,this.selector,this.caught))}}]),t}(),on=function(t){s(n,t);var e=u(n);function n(t,r,o){var i;return p(this,n),(i=e.call(this,t)).selector=r,i.caught=o,i}return g(n,[{key:"error",value:function(t){if(!this.isStopped){var e;try{e=this.selector(t,this.caught)}catch(s){return void i(f(n.prototype),"error",this).call(this,s)}this._unsubscribeAndRecycle();var r=new yt(this);this.add(r);var o=mt(e,r);o!==r&&this.add(o)}}}]),n}(wt);function sn(t){return t.adsbTracks=t.adsbTracks||[],t.externalPointingTracks=t.externalPointingTracks||[],t.rfTracks=t.rfTracks||[],t}function cn(t){return t.trackingObjects=t.trackingObjects.map(sn),t}var un=function(t){s(n,t);var e=u(n);function n(t){var r;return p(this,n),(r=e.call(this,"/monitoring-v3",t+"hubs")).startConnection(),r}return g(n,[{key:"getTimepointsStream",value:function(t){var e=this;return this.connectionStatu$.pipe(Pt(function(t){return t.state===we.Connected}),nn(),St(function(n){return e.getWrappedTimepointsStream(t)}),it(cn),function(t){return function(e){var n=new rn(t),r=e.lift(n);return n.caught=r}}(function(n){return xt(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=-1;return Ye(e)?r=Number(e)<1?1:Number(e):F(e)&&(n=e),F(n)||(n=$e),new T(function(e){var o=Ye(t)?t:+t-n.now();return n.schedule(ze,o,{index:0,period:r,subscriber:e})})}(10).pipe(St(function(){return B(n)})),e.connectionStatu$.pipe(Pt(function(t){return t.state!==we.Connected}))).pipe(nn(),St(function(){return e.getTimepointsStream(t)}))}))}},{key:"getWrappedTimepointsStream",value:function(t){var e=this;return new T(function(n){return e._connection.invoke("SubscribeOnArea",t).then(function(){e._connection.on("OnTimepoint",function(t){return n.next(t)}),e._connection.onreconnecting(function(t){return n.error(t)})}).catch(function(t){return n.error(t)}),{unsubscribe:function(){e._connection.invoke("UnsubscribeClient").then(function(){return e._connection.off("OnTimepoint")})}}})}}]),n}(function(){function t(e,n){var r=this;p(this,t),this._connectionStatusSubject=new J(1),this._connection=(new Ve).withUrl(n+e).configureLogging(Gt.Warning).withAutomaticReconnect({nextRetryDelayInMilliseconds:function(t){return 5e3}}).build(),this._connection.onreconnecting(function(t){return r._handleConnectionError(t,"Reconnecting! See next info:")}),this._connection.onreconnected(function(t){return r._handleConnectionSuccess()})}return g(t,[{key:"connectionStatu$",get:function(){return this._connectionStatusSubject.asObservable()}},{key:"connectionId",get:function(){return this._connection.connectionId}},{key:"startConnection",value:function(){var t=this;this._connection.state===we.Disconnected&&(this._riseConnectionStateChangedEvent(null,we.Connecting),this._connection.start().then(function(e){return t._handleConnectionSuccess()},function(e){return t._handleConnectionError(e)}).catch(function(e){return t._handleConnectionError(e)}))}},{key:"stopConnection",value:function(){var t=this;this._connection.state===we.Connected&&(this._riseConnectionStateChangedEvent(null,we.Disconnecting),this._connection.stop().then(function(e){return t._handleConnectionStopped()},function(e){return t._handleConnectionError(e)}).catch(function(e){return t._handleConnectionError(e)}))}},{key:"_handleConnectionSuccess",value:function(){console.info("Connected to SignalR hub!"),this._riseConnectionStateChangedEvent()}},{key:"_handleConnectionError",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Connect to SignalR hub failed: see next error.";console.error(e),console.error(t),this._riseConnectionStateChangedEvent(t)}},{key:"_handleConnectionStopped",value:function(){console.info("Disconnected from SignalR hub!"),this._riseConnectionStateChangedEvent()}},{key:"_riseConnectionStateChangedEvent",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._connectionStatusSubject.next({state:e||this._connection.state,error:t,connectionId:this._connection.connectionId})}}]),t}());!function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var i=Array.isArray(r)?e(t,[rt.messages$].concat(r)):new t(rt.messages$);ot.push(i)}(function(e){s(r,e);var n=u(r);function r(e){var o;return p(this,r),(o=n.call(this,e)).startMonitoring$=Ht(function(){return xt(o.messages$.pipe(jt(qt.startMonitoring),it(function(t){return{isStarted:!0,areaId:t.areaId}})),o.messages$.pipe(jt(qt.stopMonitoring),it(function(){return{isStarted:!1,areaId:null}}))).pipe(function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){var n;return"function"==typeof e[e.length-1]&&(n=e.pop()),t.lift(new gt(e,n))}}(o.initPayload$),St(function(e){var n=t(e,2),r=n[0],o=r.isStarted,i=r.areaId,s=n[1].backendApiUrl;return o?new un(s).getTimepointsStream(i):H}),it(function(t,e){return Lt.timePointReceive({timePoint:t,isFirstTimepoint:0===e})}))}),o}return r}(function(){return function t(e){var n;p(this,t),this.messages$=e,this.init$=Ht(function(t){return t.pipe(jt(et),function(t){return function(e){return e.lift(new Wt(t))}}(nt()))}),this.initPayload$=this.messages$.pipe(jt(et),it(function(t){return t.initPayload}),(n={bufferSize:1,windowTime:void 0,refCount:!1,scheduler:void 0},function(t){return t.lift(function(t){var e,n,r=t.bufferSize,o=void 0===r?Number.POSITIVE_INFINITY:r,i=t.windowTime,s=void 0===i?Number.POSITIVE_INFINITY:i,c=t.refCount,u=t.scheduler,a=0,l=!1,h=!1;return function(t){var r;a++,!e||l?(l=!1,e=new J(o,s,u),r=e.subscribe(this),n=t.subscribe({next:function(t){e.next(t)},error:function(t){l=!0,e.error(t)},complete:function(){h=!0,n=void 0,e.complete()}}),h&&(n=void 0)):r=e.subscribe(this),this.add(function(){a--,r.unsubscribe(),r=void 0,n&&!h&&c&&0===a&&(n.unsubscribe(),n=void 0,e=void 0)})}}(n))}))}}()))}()}();