!function(){"use strict";function t(t){return"function"==typeof t}let e=!1;const n={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){const t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else e&&console.log("RxJS: Back to a better error behavior. Thank you. <3");e=t},get useDeprecatedSynchronousErrorHandling(){return e}};function r(t){setTimeout(()=>{throw t},0)}const o={closed:!0,next(t){},error(t){if(n.useDeprecatedSynchronousErrorHandling)throw t;r(t)},complete(){}},s=Array.isArray||(t=>t&&"number"==typeof t.length);function i(t){return null!==t&&"object"==typeof t}const c=(()=>{function t(t){return Error.call(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((t,e)=>`${e+1}) ${t.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t})();class a{constructor(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}unsubscribe(){let e;if(this.closed)return;let{_parentOrParents:n,_ctorUnsubscribe:r,_unsubscribe:o,_subscriptions:u}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof a)n.remove(this);else if(null!==n)for(let t=0;t<n.length;++t)n[t].remove(this);if(t(o)){r&&(this._unsubscribe=void 0);try{o.call(this)}catch(l){e=l instanceof c?h(l.errors):[l]}}if(s(u)){let t=-1,n=u.length;for(;++t<n;){const n=u[t];if(i(n))try{n.unsubscribe()}catch(p){e=e||[],p instanceof c?e=e.concat(h(p.errors)):e.push(p)}}}if(e)throw new c(e)}add(t){let e=t;if(!t)return a.EMPTY;switch(typeof t){case"function":e=new a(t);case"object":if(e===this||e.closed||"function"!=typeof e.unsubscribe)return e;if(this.closed)return e.unsubscribe(),e;if(!(e instanceof a)){const t=e;e=new a,e._subscriptions=[t]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}let{_parentOrParents:n}=e;if(null===n)e._parentOrParents=this;else if(n instanceof a){if(n===this)return e;e._parentOrParents=[n,this]}else{if(-1!==n.indexOf(this))return e;n.push(this)}const r=this._subscriptions;return null===r?this._subscriptions=[e]:r.push(e),e}remove(t){const e=this._subscriptions;if(e){const n=e.indexOf(t);-1!==n&&e.splice(n,1)}}}var u;function h(t){return t.reduce((t,e)=>t.concat(e instanceof c?e.errors:e),[])}a.EMPTY=((u=new a).closed=!0,u);const l="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class p extends a{constructor(t,e,n){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=o;break;case 1:if(!t){this.destination=o;break}if("object"==typeof t){t instanceof p?(this.syncErrorThrowable=t.syncErrorThrowable,this.destination=t,t.add(this)):(this.syncErrorThrowable=!0,this.destination=new d(this,t));break}default:this.syncErrorThrowable=!0,this.destination=new d(this,t,e,n)}}[l](){return this}static create(t,e,n){const r=new p(t,e,n);return r.syncErrorThrowable=!1,r}next(t){this.isStopped||this._next(t)}error(t){this.isStopped||(this.isStopped=!0,this._error(t))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(t){this.destination.next(t)}_error(t){this.destination.error(t),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:t}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this}}class d extends p{constructor(e,n,r,s){super(),this._parentSubscriber=e;let i,c=this;t(n)?i=n:n&&(i=n.next,r=n.error,s=n.complete,n!==o&&(c=Object.create(n),t(c.unsubscribe)&&this.add(c.unsubscribe.bind(c)),c.unsubscribe=this.unsubscribe.bind(this))),this._context=c,this._next=i,this._error=r,this._complete=s}next(t){if(!this.isStopped&&this._next){const{_parentSubscriber:e}=this;n.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}}error(t){if(!this.isStopped){const{_parentSubscriber:e}=this,{useDeprecatedSynchronousErrorHandling:o}=n;if(this._error)o&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)o?(e.syncErrorValue=t,e.syncErrorThrown=!0):r(t),this.unsubscribe();else{if(this.unsubscribe(),o)throw t;r(t)}}}complete(){if(!this.isStopped){const{_parentSubscriber:t}=this;if(this._complete){const e=()=>this._complete.call(this._context);n.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,e),this.unsubscribe()):(this.__tryOrUnsub(e),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(t,e){try{t.call(this._context,e)}catch(o){if(this.unsubscribe(),n.useDeprecatedSynchronousErrorHandling)throw o;r(o)}}__tryOrSetError(t,e,o){if(!n.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,o)}catch(s){return n.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=s,t.syncErrorThrown=!0,!0):(r(s),!0)}return!1}_unsubscribe(){const{_parentSubscriber:t}=this;this._context=null,this._parentSubscriber=null,t.unsubscribe()}}const f="function"==typeof Symbol&&Symbol.observable||"@@observable";function g(t){return t}let b=(()=>{class t{constructor(t){this._isScalar=!1,t&&(this._subscribe=t)}lift(e){const n=new t;return n.source=this,n.operator=e,n}subscribe(t,e,r){const{operator:s}=this,i=function(t,e,n){if(t){if(t instanceof p)return t;if(t[l])return t[l]()}return t||e||n?new p(t,e,n):new p(o)}(t,e,r);if(i.add(s?s.call(i,this.source):this.source||n.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),n.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i}_trySubscribe(t){try{return this._subscribe(t)}catch(e){n.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),function(t){for(;t;){const{closed:e,destination:n,isStopped:r}=t;if(e||r)return!1;t=n&&n instanceof p?n:null}return!0}(t)?t.error(e):console.warn(e)}}forEach(t,e){return new(e=y(e))((e,n)=>{let r;r=this.subscribe(e=>{try{t(e)}catch(o){n(o),r&&r.unsubscribe()}},n,e)})}_subscribe(t){const{source:e}=this;return e&&e.subscribe(t)}[f](){return this}pipe(...t){return 0===t.length?this:function(t){return 0===t.length?g:1===t.length?t[0]:function(e){return t.reduce((t,e)=>e(t),e)}}(t)(this)}toPromise(t){return new(t=y(t))((t,e)=>{let n;this.subscribe(t=>n=t,t=>e(t),()=>t(n))})}}return t.create=e=>new t(e),t})();function y(t){if(t||(t=n.Promise||Promise),!t)throw new Error("no Promise impl found");return t}const v=(()=>{function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t})();class w extends a{constructor(t,e){super(),this.subject=t,this.subscriber=e,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const t=this.subject,e=t.observers;if(this.subject=null,!e||0===e.length||t.isStopped||t.closed)return;const n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}class m extends p{constructor(t){super(t),this.destination=t}}let S=(()=>{class t extends b{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[l](){return new m(this)}lift(t){const e=new E(this,this);return e.operator=t,e}next(t){if(this.closed)throw new v;if(!this.isStopped){const{observers:e}=this,n=e.length,r=e.slice();for(let o=0;o<n;o++)r[o].next(t)}}error(t){if(this.closed)throw new v;this.hasError=!0,this.thrownError=t,this.isStopped=!0;const{observers:e}=this,n=e.length,r=e.slice();for(let o=0;o<n;o++)r[o].error(t);this.observers.length=0}complete(){if(this.closed)throw new v;this.isStopped=!0;const{observers:t}=this,e=t.length,n=t.slice();for(let r=0;r<e;r++)n[r].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(t){if(this.closed)throw new v;return super._trySubscribe(t)}_subscribe(t){if(this.closed)throw new v;return this.hasError?(t.error(this.thrownError),a.EMPTY):this.isStopped?(t.complete(),a.EMPTY):(this.observers.push(t),new w(this,t))}asObservable(){const t=new b;return t.source=this,t}}return t.create=(t,e)=>new E(t,e),t})();class E extends S{constructor(t,e){super(),this.destination=t,this.source=e}next(t){const{destination:e}=this;e&&e.next&&e.next(t)}error(t){const{destination:e}=this;e&&e.error&&this.destination.error(t)}complete(){const{destination:t}=this;t&&t.complete&&this.destination.complete()}_subscribe(t){const{source:e}=this;return e?this.source.subscribe(t):a.EMPTY}}class C extends a{constructor(t,e){super()}schedule(t,e=0){return this}}class x extends C{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t;const n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this}requestAsyncId(t,e,n=0){return setInterval(t.flush.bind(t,this),n)}recycleAsyncId(t,e,n=0){if(null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let n,r=!1;try{this.work(t)}catch(o){r=!0,n=!!o&&o||new Error(o)}if(r)return this.unsubscribe(),n}_unsubscribe(){const t=this.id,e=this.scheduler,n=e.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null}}let _=(()=>{class t{constructor(e,n=t.now){this.SchedulerAction=e,this.now=n}schedule(t,e=0,n){return new this.SchedulerAction(this,t).schedule(n,e)}}return t.now=()=>Date.now(),t})();class T extends _{constructor(t,e=_.now){super(t,()=>T.delegate&&T.delegate!==this?T.delegate.now():e()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(t,e=0,n){return T.delegate&&T.delegate!==this?T.delegate.schedule(t,e,n):super.schedule(t,e,n)}flush(t){const{actions:e}=this;if(this.active)return void e.push(t);let n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}}const k=new class extends T{}(class extends x{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}schedule(t,e=0){return e>0?super.schedule(t,e):(this.delay=e,this.state=t,this.scheduler.flush(this),this)}execute(t,e){return e>0||this.closed?super.execute(t,e):this._execute(t,e)}requestAsyncId(t,e,n=0){return null!==n&&n>0||null===n&&this.delay>0?super.requestAsyncId(t,e,n):t.flush(this)}}),I=new b(t=>t.complete());function P(t){return t?function(t){return new b(e=>t.schedule(()=>e.complete()))}(t):I}function D(t){return t&&"function"==typeof t.schedule}const O=t=>e=>{for(let n=0,r=t.length;n<r&&!e.closed;n++)e.next(t[n]);e.complete()};function R(t,e){return new b(n=>{const r=new a;let o=0;return r.add(e.schedule(function(){o!==t.length?(n.next(t[o++]),n.closed||r.add(this.schedule())):n.complete()})),r})}function j(t,e){return e?R(t,e):new b(O(t))}function N(t,e){return new b(e?n=>e.schedule(A,0,{error:t,subscriber:n}):e=>e.error(t))}function A({error:t,subscriber:e}){e.error(t)}class M{constructor(t,e,n){this.kind=t,this.value=e,this.error=n,this.hasValue="N"===t}observe(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}}do(t,e,n){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return n&&n()}}accept(t,e,n){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,n)}toObservable(){switch(this.kind){case"N":return function(...t){let e=t[t.length-1];return D(e)?(t.pop(),R(t,e)):j(t)}(this.value);case"E":return N(this.error);case"C":return P()}throw new Error("unexpected notification kind value")}static createNext(t){return void 0!==t?new M("N",t):M.undefinedValueNotification}static createError(t){return new M("E",void 0,t)}static createComplete(){return M.completeNotification}}M.completeNotification=new M("C"),M.undefinedValueNotification=new M("N",void 0);class H extends p{constructor(t,e,n=0){super(t),this.scheduler=e,this.delay=n}static dispatch(t){const{notification:e,destination:n}=t;e.observe(n),this.unsubscribe()}scheduleMessage(t){this.destination.add(this.scheduler.schedule(H.dispatch,this.delay,new W(t,this.destination)))}_next(t){this.scheduleMessage(M.createNext(t))}_error(t){this.scheduleMessage(M.createError(t)),this.unsubscribe()}_complete(){this.scheduleMessage(M.createComplete()),this.unsubscribe()}}class W{constructor(t,e){this.notification=t,this.destination=e}}class F extends S{constructor(t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,n){super(),this.scheduler=n,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=t<1?1:t,this._windowTime=e<1?1:e,e===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(t){if(!this.isStopped){const e=this._events;e.push(t),e.length>this._bufferSize&&e.shift()}super.next(t)}nextTimeWindow(t){this.isStopped||(this._events.push(new q(this._getNow(),t)),this._trimBufferThenGetEvents()),super.next(t)}_subscribe(t){const e=this._infiniteTimeWindow,n=e?this._events:this._trimBufferThenGetEvents(),r=this.scheduler,o=n.length;let s;if(this.closed)throw new v;if(this.isStopped||this.hasError?s=a.EMPTY:(this.observers.push(t),s=new w(this,t)),r&&t.add(t=new H(t,r)),e)for(let i=0;i<o&&!t.closed;i++)t.next(n[i]);else for(let i=0;i<o&&!t.closed;i++)t.next(n[i].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),s}_getNow(){return(this.scheduler||k).now()}_trimBufferThenGetEvents(){const t=this._getNow(),e=this._bufferSize,n=this._windowTime,r=this._events,o=r.length;let s=0;for(;s<o&&!(t-r[s].time<n);)s++;return o>e&&(s=Math.max(s,o-e)),s>0&&r.splice(0,s),r}}class q{constructor(t,e){this.time=t,this.value=e}}const L=(()=>{function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t})();function U(t){return e=>0===t?P():e.lift(new V(t))}class V{constructor(t){if(this.total=t,this.total<0)throw new L}call(t,e){return e.subscribe(new B(t,this.total))}}class B extends p{constructor(t,e){super(t),this.total=e,this.count=0}_next(t){const e=this.total,n=++this.count;n<=e&&(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))}}function $(t,e){const n=e=>Object.assign({type:t,_isMessage:!0},e);return n.type=t,n}const Y=$("INIT"),z=$("INIT_SUCCESS"),J=new class{constructor(){this.initSuccess$=new F(1),this.messages$=new S}start(){addEventListener("message",({data:t})=>{t.type===Y.type?this.messages$.next(t):this.initSuccess$.pipe(U(1)).subscribe(()=>this.messages$.next(t))})}postMessage(t){postMessage(t),t.type===z.type&&this.initSuccess$.next()}};J.start();const G=[];function X(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new K(t,e))}}class K{constructor(t,e){this.project=t,this.thisArg=e}call(t,e){return e.subscribe(new Q(t,this.project,this.thisArg))}}class Q extends p{constructor(t,e,n){super(t),this.project=e,this.count=0,this.thisArg=n||this}_next(t){let e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(e)}}class Z extends p{notifyNext(t,e,n,r,o){this.destination.next(e)}notifyError(t,e){this.destination.error(t)}notifyComplete(t){this.destination.complete()}}class tt extends p{constructor(t,e,n){super(),this.parent=t,this.outerValue=e,this.outerIndex=n,this.index=0}_next(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)}_error(t){this.parent.notifyError(t,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}const et="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",nt=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function rt(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}const ot=t=>{if(t&&"function"==typeof t[f])return(t=>e=>{const n=t[f]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(e)})(t);if(nt(t))return O(t);if(rt(t))return(t=>e=>(t.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,r),e))(t);if(t&&"function"==typeof t[et])return(t=>e=>{const n=t[et]();for(;;){let t;try{t=n.next()}catch(r){return e.error(r),e}if(t.done){e.complete();break}if(e.next(t.value),e.closed)break}return"function"==typeof n.return&&e.add(()=>{n.return&&n.return()}),e})(t);{const e=`You provided ${i(t)?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(e)}};function st(t,e,n,r,o=new tt(t,n,r)){if(!o.closed)return e instanceof b?e.subscribe(o):ot(e)(o)}class it{constructor(t,e){this.observables=t,this.project=e}call(t,e){return e.subscribe(new ct(t,this.observables,this.project))}}class ct extends Z{constructor(t,e,n){super(t),this.observables=e,this.project=n,this.toRespond=[];const r=e.length;this.values=new Array(r);for(let o=0;o<r;o++)this.toRespond.push(o);for(let o=0;o<r;o++)this.add(st(this,e[o],void 0,o))}notifyNext(t,e,n){this.values[n]=e;const r=this.toRespond;if(r.length>0){const t=r.indexOf(n);-1!==t&&r.splice(t,1)}}notifyComplete(){}_next(t){if(0===this.toRespond.length){const e=[t,...this.values];this.project?this._tryProject(e):this.destination.next(e)}}_tryProject(t){let e;try{e=this.project.apply(this,t)}catch(n){return void this.destination.error(n)}this.destination.next(e)}}function at(t,e){return e?function(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[f]}(t))return function(t,e){return new b(n=>{const r=new a;return r.add(e.schedule(()=>{const o=t[f]();r.add(o.subscribe({next(t){r.add(e.schedule(()=>n.next(t)))},error(t){r.add(e.schedule(()=>n.error(t)))},complete(){r.add(e.schedule(()=>n.complete()))}}))})),r})}(t,e);if(rt(t))return function(t,e){return new b(n=>{const r=new a;return r.add(e.schedule(()=>t.then(t=>{r.add(e.schedule(()=>{n.next(t),r.add(e.schedule(()=>n.complete()))}))},t=>{r.add(e.schedule(()=>n.error(t)))}))),r})}(t,e);if(nt(t))return R(t,e);if(function(t){return t&&"function"==typeof t[et]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new b(n=>{const r=new a;let o;return r.add(()=>{o&&"function"==typeof o.return&&o.return()}),r.add(e.schedule(()=>{o=t[et](),r.add(e.schedule(function(){if(n.closed)return;let t,e;try{const n=o.next();t=n.value,e=n.done}catch(r){return void n.error(r)}e?n.complete():(n.next(t),this.schedule())}))})),r})}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}(t,e):t instanceof b?t:new b(ot(t))}class ut extends p{constructor(t){super(),this.parent=t}_next(t){this.parent.notifyNext(t)}_error(t){this.parent.notifyError(t),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class ht extends p{notifyNext(t){this.destination.next(t)}notifyError(t){this.destination.error(t)}notifyComplete(){this.destination.complete()}}function lt(t,e){if(e.closed)return;if(t instanceof b)return t.subscribe(e);let n;try{n=ot(t)(e)}catch(r){e.error(r)}return n}function pt(t,e){return"function"==typeof e?n=>n.pipe(pt((n,r)=>at(t(n,r)).pipe(X((t,o)=>e(n,t,r,o))))):e=>e.lift(new dt(t))}class dt{constructor(t){this.project=t}call(t,e){return e.subscribe(new ft(t,this.project))}}class ft extends ht{constructor(t,e){super(t),this.project=e,this.index=0}_next(t){let e;const n=this.index++;try{e=this.project(t,n)}catch(r){return void this.destination.error(r)}this._innerSub(e)}_innerSub(t){const e=this.innerSubscription;e&&e.unsubscribe();const n=new ut(this),r=this.destination;r.add(n),this.innerSubscription=lt(t,n),this.innerSubscription!==n&&r.add(this.innerSubscription)}_complete(){const{innerSubscription:t}=this;(!t||t.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(t){this.destination.next(t)}}function gt(t,e,n=Number.POSITIVE_INFINITY){return"function"==typeof e?r=>r.pipe(gt((n,r)=>at(t(n,r)).pipe(X((t,o)=>e(n,t,r,o))),n)):("number"==typeof e&&(n=e),e=>e.lift(new bt(t,n)))}class bt{constructor(t,e=Number.POSITIVE_INFINITY){this.project=t,this.concurrent=e}call(t,e){return e.subscribe(new yt(t,this.project,this.concurrent))}}class yt extends ht{constructor(t,e,n=Number.POSITIVE_INFINITY){super(t),this.project=e,this.concurrent=n,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)}_tryNext(t){let e;const n=this.index++;try{e=this.project(t,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(e)}_innerSub(t){const e=new ut(this),n=this.destination;n.add(e);const r=lt(t,e);r!==e&&n.add(r)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(t){this.destination.next(t)}notifyComplete(){const t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function vt(t=Number.POSITIVE_INFINITY){return gt(g,t)}function wt(...t){let e=Number.POSITIVE_INFINITY,n=null,r=t[t.length-1];return D(r)?(n=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(e=t.pop())):"number"==typeof r&&(e=t.pop()),null===n&&1===t.length&&t[0]instanceof b?t[0]:vt(e)(j(t,n))}function mt(t,e){return function(n){return n.lift(new St(t,e))}}class St{constructor(t,e){this.predicate=t,this.thisArg=e}call(t,e){return e.subscribe(new Et(t,this.predicate,this.thisArg))}}class Et extends p{constructor(t,e,n){super(t),this.predicate=e,this.thisArg=n,this.count=0}_next(t){let e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}e&&this.destination.next(t)}}function Ct(...t){return mt(e=>t.some(t=>"string"==typeof t?t===e.type:t.type===e.type))}function xt(){}class _t{constructor(t,e,n){this.nextOrObserver=t,this.error=e,this.complete=n}call(t,e){return e.subscribe(new Tt(t,this.nextOrObserver,this.error,this.complete))}}class Tt extends p{constructor(e,n,r,o){super(e),this._tapNext=xt,this._tapError=xt,this._tapComplete=xt,this._tapError=r||xt,this._tapComplete=o||xt,t(n)?(this._context=this,this._tapNext=n):n&&(this._context=n,this._tapNext=n.next||xt,this._tapError=n.error||xt,this._tapComplete=n.complete||xt)}_next(t){try{this._tapNext.call(this._context,t)}catch(e){return void this.destination.error(e)}this.destination.next(t)}_error(t){try{this._tapError.call(this._context,t)}catch(e){return void this.destination.error(e)}this.destination.error(t)}_complete(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()}}const kt=[];function It(t,e={postMessage:!0}){let n=t(J.messages$);e.postMessage&&(n=n.pipe(function(t,e,n){return function(e){return e.lift(new _t(t,undefined,undefined))}}(t=>{J.postMessage(t)}))),kt.push(n.subscribe())}class Pt{constructor(t){this.value=t}call(t,e){return e.subscribe(new Dt(t,this.value))}}class Dt extends p{constructor(t,e){super(t),this.value=e}_next(t){this.destination.next(this.value)}}const Ot={startMonitoring:$("startMonitoring"),stopMonitoring:$("stopMonitoring")},Rt={timePointReceive:$("timePointReceive")};var jt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Nt=function(t){function e(e,n){var r=this,o=this.constructor.prototype;return(r=t.call(this,e)||this).statusCode=n,r.__proto__=o,r}return jt(e,t),e}(Error),At=function(t){function e(e){void 0===e&&(e="A timeout occurred.");var n=this,r=this.constructor.prototype;return(n=t.call(this,e)||this).__proto__=r,n}return jt(e,t),e}(Error),Mt=function(t){function e(e){void 0===e&&(e="An abort occurred.");var n=this,r=this.constructor.prototype;return(n=t.call(this,e)||this).__proto__=r,n}return jt(e,t),e}(Error),Ht=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},Wt=function(t,e,n){this.statusCode=t,this.statusText=e,this.content=n},Ft=function(){function t(){}return t.prototype.get=function(t,e){return this.send(Ht({},e,{method:"GET",url:t}))},t.prototype.post=function(t,e){return this.send(Ht({},e,{method:"POST",url:t}))},t.prototype.delete=function(t,e){return this.send(Ht({},e,{method:"DELETE",url:t}))},t.prototype.getCookieString=function(t){return""},t}(),qt=(()=>(function(t){t[t.Trace=0]="Trace",t[t.Debug=1]="Debug",t[t.Information=2]="Information",t[t.Warning=3]="Warning",t[t.Error=4]="Error",t[t.Critical=5]="Critical",t[t.None=6]="None"}(qt||(qt={})),qt))(),Lt=function(){function t(){}return t.prototype.log=function(t,e){},t.instance=new t,t}(),Ut=function(){function t(){}return t.isRequired=function(t,e){if(null==t)throw new Error("The '"+e+"' argument is required.")},t.isIn=function(t,e,n){if(!(t in e))throw new Error("Unknown "+n+" value: "+t+".")},t}(),Vt=function(){function t(){}return Object.defineProperty(t,"isBrowser",{get:function(){return"object"==typeof window},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isWebWorker",{get:function(){return"object"==typeof self&&"importScripts"in self},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isNode",{get:function(){return!this.isBrowser&&!this.isWebWorker},enumerable:!0,configurable:!0}),t}();function Bt(t,e){var n="";return $t(t)?(n="Binary data of length "+t.byteLength,e&&(n+=". Content: '"+function(t){var e=new Uint8Array(t),n="";return e.forEach(function(t){n+="0x"+(t<16?"0":"")+t.toString(16)+" "}),n.substr(0,n.length-1)}(t)+"'")):"string"==typeof t&&(n="String data of length "+t.length,e&&(n+=". Content: '"+t+"'")),n}function $t(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Yt(t,e,n,r,o,s,i){return function(t,e,n,r){return new(n||(n=Promise))(function(e,o){function s(t){try{c(r.next(t))}catch(e){o(e)}}function i(t){try{c(r.throw(t))}catch(e){o(e)}}function c(t){t.done?e(t.value):new n(function(e){e(t.value)}).then(s,i)}c((r=r.apply(t,[])).next())})}(this,0,void 0,function(){var c,a,u,h,l;return function(t,e){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function c(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(c){s=[6,c],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}(this,function(p){switch(p.label){case 0:return o?[4,o()]:[3,2];case 1:(u=p.sent())&&((c={}).Authorization="Bearer "+u,a=c),p.label=2;case 2:return t.log(qt.Trace,"("+e+" transport) sending data. "+Bt(s,i)+"."),h=$t(s)?"arraybuffer":"text",[4,n.post(r,{content:s,headers:a,responseType:h})];case 3:return l=p.sent(),t.log(qt.Trace,"("+e+" transport) request complete. Response status: "+l.statusCode+"."),[2]}})})}var zt,Jt=function(){function t(t,e){this.subject=t,this.observer=e}return t.prototype.dispose=function(){var t=this.subject.observers.indexOf(this.observer);t>-1&&this.subject.observers.splice(t,1),0===this.subject.observers.length&&this.subject.cancelCallback&&this.subject.cancelCallback().catch(function(t){})},t}(),Gt=function(){function t(t){this.minimumLogLevel=t,this.outputConsole=console}return t.prototype.log=function(t,e){if(t>=this.minimumLogLevel)switch(t){case qt.Critical:case qt.Error:this.outputConsole.error("["+(new Date).toISOString()+"] "+qt[t]+": "+e);break;case qt.Warning:this.outputConsole.warn("["+(new Date).toISOString()+"] "+qt[t]+": "+e);break;case qt.Information:this.outputConsole.info("["+(new Date).toISOString()+"] "+qt[t]+": "+e);break;default:this.outputConsole.log("["+(new Date).toISOString()+"] "+qt[t]+": "+e)}},t}(),Xt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Kt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t};if("undefined"==typeof XMLHttpRequest){var Qt=require;zt=Qt("request")}var Zt=function(t){function e(e){var n=t.call(this)||this;if(void 0===zt)throw new Error("The 'request' module could not be loaded.");return n.logger=e,n.cookieJar=zt.jar(),n.request=zt.defaults({jar:n.cookieJar}),n}return Xt(e,t),e.prototype.send=function(t){var e=this;return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new Mt):new Promise(function(n,r){var o;o=$t(t.content)?Buffer.from(t.content):t.content||"";var s=e.request(t.url,{body:o,encoding:"arraybuffer"===t.responseType?null:"utf8",headers:Kt({"X-Requested-With":"XMLHttpRequest"},t.headers),method:t.method,timeout:t.timeout},function(o,s,i){if(t.abortSignal&&(t.abortSignal.onabort=null),o)return"ETIMEDOUT"===o.code&&(e.logger.log(qt.Warning,"Timeout from HTTP request."),r(new At)),e.logger.log(qt.Warning,"Error from HTTP request. "+o),void r(o);s.statusCode>=200&&s.statusCode<300?n(new Wt(s.statusCode,s.statusMessage||"",i)):r(new Nt(s.statusMessage||"",s.statusCode||0))});t.abortSignal&&(t.abortSignal.onabort=function(){s.abort(),r(new Mt)})})},e.prototype.getCookieString=function(t){return this.cookieJar.getCookieString(t)},e}(Ft),te=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ee=function(t){function e(e){var n=t.call(this)||this;return n.logger=e,n}return te(e,t),e.prototype.send=function(t){var e=this;return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new Mt):t.method?t.url?new Promise(function(n,r){var o=new XMLHttpRequest;o.open(t.method,t.url,!0),o.withCredentials=!0,o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.setRequestHeader("Content-Type","text/plain;charset=UTF-8");var s=t.headers;s&&Object.keys(s).forEach(function(t){o.setRequestHeader(t,s[t])}),t.responseType&&(o.responseType=t.responseType),t.abortSignal&&(t.abortSignal.onabort=function(){o.abort(),r(new Mt)}),t.timeout&&(o.timeout=t.timeout),o.onload=function(){t.abortSignal&&(t.abortSignal.onabort=null),o.status>=200&&o.status<300?n(new Wt(o.status,o.statusText,o.response||o.responseText)):r(new Nt(o.statusText,o.status))},o.onerror=function(){e.logger.log(qt.Warning,"Error from HTTP request. "+o.status+": "+o.statusText+"."),r(new Nt(o.statusText,o.status))},o.ontimeout=function(){e.logger.log(qt.Warning,"Timeout from HTTP request."),r(new At)},o.send(t.content||"")}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))},e}(Ft),ne=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),re=function(t){function e(e){var n=t.call(this)||this;return n.httpClient="undefined"!=typeof XMLHttpRequest?new ee(e):new Zt(e),n}return ne(e,t),e.prototype.send=function(t){return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new Mt):t.method?t.url?this.httpClient.send(t):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))},e.prototype.getCookieString=function(t){return this.httpClient.getCookieString(t)},e}(Ft),oe=function(){function t(){}return t.write=function(e){return""+e+t.RecordSeparator},t.parse=function(e){if(e[e.length-1]!==t.RecordSeparator)throw new Error("Message is incomplete.");var n=e.split(t.RecordSeparator);return n.pop(),n},t.RecordSeparatorCode=30,t.RecordSeparator=String.fromCharCode(t.RecordSeparatorCode),t}(),se=function(){function t(){}return t.prototype.writeHandshakeRequest=function(t){return oe.write(JSON.stringify(t))},t.prototype.parseHandshakeResponse=function(t){var e,n;if($t(t)||"undefined"!=typeof Buffer&&t instanceof Buffer){var r=new Uint8Array(t);if(-1===(s=r.indexOf(oe.RecordSeparatorCode)))throw new Error("Message is incomplete.");var o=s+1;e=String.fromCharCode.apply(null,r.slice(0,o)),n=r.byteLength>o?r.slice(o).buffer:null}else{var s,i=t;if(-1===(s=i.indexOf(oe.RecordSeparator)))throw new Error("Message is incomplete.");e=i.substring(0,o=s+1),n=i.length>o?i.substring(o):null}var c=oe.parse(e),a=JSON.parse(c[0]);if(a.type)throw new Error("Expected a handshake response from the server.");return[n,a]},t}(),ie=(()=>(function(t){t[t.Invocation=1]="Invocation",t[t.StreamItem=2]="StreamItem",t[t.Completion=3]="Completion",t[t.StreamInvocation=4]="StreamInvocation",t[t.CancelInvocation=5]="CancelInvocation",t[t.Ping=6]="Ping",t[t.Close=7]="Close"}(ie||(ie={})),ie))(),ce=function(){function t(){this.observers=[]}return t.prototype.next=function(t){for(var e=0,n=this.observers;e<n.length;e++)n[e].next(t)},t.prototype.error=function(t){for(var e=0,n=this.observers;e<n.length;e++){var r=n[e];r.error&&r.error(t)}},t.prototype.complete=function(){for(var t=0,e=this.observers;t<e.length;t++){var n=e[t];n.complete&&n.complete()}},t.prototype.subscribe=function(t){return this.observers.push(t),new Jt(this,t)},t}(),ae=function(t,e,n,r){return new(n||(n=Promise))(function(o,s){function i(t){try{a(r.next(t))}catch(e){s(e)}}function c(t){try{a(r.throw(t))}catch(e){s(e)}}function a(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(i,c)}a((r=r.apply(t,e||[])).next())})},ue=function(t,e){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function c(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(c){s=[6,c],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},he=(()=>(function(t){t.Disconnected="Disconnected",t.Connecting="Connecting",t.Connected="Connected",t.Disconnecting="Disconnecting",t.Reconnecting="Reconnecting"}(he||(he={})),he))(),le=function(){function t(t,e,n,r){var o=this;this.nextKeepAlive=0,Ut.isRequired(t,"connection"),Ut.isRequired(e,"logger"),Ut.isRequired(n,"protocol"),this.serverTimeoutInMilliseconds=3e4,this.keepAliveIntervalInMilliseconds=15e3,this.logger=e,this.protocol=n,this.connection=t,this.reconnectPolicy=r,this.handshakeProtocol=new se,this.connection.onreceive=function(t){return o.processIncomingData(t)},this.connection.onclose=function(t){return o.connectionClosed(t)},this.callbacks={},this.methods={},this.closedCallbacks=[],this.reconnectingCallbacks=[],this.reconnectedCallbacks=[],this.invocationId=0,this.receivedHandshakeResponse=!1,this.connectionState=he.Disconnected,this.connectionStarted=!1,this.cachedPingMessage=this.protocol.writeMessage({type:ie.Ping})}return t.create=function(e,n,r,o){return new t(e,n,r,o)},Object.defineProperty(t.prototype,"state",{get:function(){return this.connectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"connectionId",{get:function(){return this.connection&&this.connection.connectionId||null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"baseUrl",{get:function(){return this.connection.baseUrl||""},set:function(t){if(this.connectionState!==he.Disconnected&&this.connectionState!==he.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!t)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=t},enumerable:!0,configurable:!0}),t.prototype.start=function(){return this.startPromise=this.startWithStateTransitions(),this.startPromise},t.prototype.startWithStateTransitions=function(){return ae(this,void 0,void 0,function(){var t;return ue(this,function(e){switch(e.label){case 0:if(this.connectionState!==he.Disconnected)return[2,Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."))];this.connectionState=he.Connecting,this.logger.log(qt.Debug,"Starting HubConnection."),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.startInternal()];case 2:return e.sent(),this.connectionState=he.Connected,this.connectionStarted=!0,this.logger.log(qt.Debug,"HubConnection connected successfully."),[3,4];case 3:return t=e.sent(),this.connectionState=he.Disconnected,this.logger.log(qt.Debug,"HubConnection failed to start successfully because of error '"+t+"'."),[2,Promise.reject(t)];case 4:return[2]}})})},t.prototype.startInternal=function(){return ae(this,void 0,void 0,function(){var t,e,n,r=this;return ue(this,function(o){switch(o.label){case 0:return this.stopDuringStartError=void 0,this.receivedHandshakeResponse=!1,t=new Promise(function(t,e){r.handshakeResolver=t,r.handshakeRejecter=e}),[4,this.connection.start(this.protocol.transferFormat)];case 1:o.sent(),o.label=2;case 2:return o.trys.push([2,5,,7]),e={protocol:this.protocol.name,version:this.protocol.version},this.logger.log(qt.Debug,"Sending handshake request."),[4,this.sendMessage(this.handshakeProtocol.writeHandshakeRequest(e))];case 3:return o.sent(),this.logger.log(qt.Information,"Using HubProtocol '"+this.protocol.name+"'."),this.cleanupTimeout(),this.resetTimeoutPeriod(),this.resetKeepAliveInterval(),[4,t];case 4:if(o.sent(),this.stopDuringStartError)throw this.stopDuringStartError;return[3,7];case 5:return n=o.sent(),this.logger.log(qt.Debug,"Hub handshake failed with error '"+n+"' during start(). Stopping HubConnection."),this.cleanupTimeout(),this.cleanupPingTimer(),[4,this.connection.stop(n)];case 6:throw o.sent(),n;case 7:return[2]}})})},t.prototype.stop=function(){return ae(this,void 0,void 0,function(){var t;return ue(this,function(e){switch(e.label){case 0:return t=this.startPromise,this.stopPromise=this.stopInternal(),[4,this.stopPromise];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,4,,5]),[4,t];case 3:case 4:return e.sent(),[3,5];case 5:return[2]}})})},t.prototype.stopInternal=function(t){return this.connectionState===he.Disconnected?(this.logger.log(qt.Debug,"Call to HubConnection.stop("+t+") ignored because it is already in the disconnected state."),Promise.resolve()):this.connectionState===he.Disconnecting?(this.logger.log(qt.Debug,"Call to HttpConnection.stop("+t+") ignored because the connection is already in the disconnecting state."),this.stopPromise):(this.connectionState=he.Disconnecting,this.logger.log(qt.Debug,"Stopping HubConnection."),this.reconnectDelayHandle?(this.logger.log(qt.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this.reconnectDelayHandle),this.reconnectDelayHandle=void 0,this.completeClose(),Promise.resolve()):(this.cleanupTimeout(),this.cleanupPingTimer(),this.stopDuringStartError=t||new Error("The connection was stopped before the hub handshake could complete."),this.connection.stop(t)))},t.prototype.stream=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o,s=this.replaceStreamingParams(n),i=s[0],c=s[1],a=this.createStreamInvocation(t,n,c),u=new ce;return u.cancelCallback=function(){var t=e.createCancelInvocation(a.invocationId);return delete e.callbacks[a.invocationId],o.then(function(){return e.sendWithProtocol(t)})},this.callbacks[a.invocationId]=function(t,e){e?u.error(e):t&&(t.type===ie.Completion?t.error?u.error(new Error(t.error)):u.complete():u.next(t.item))},o=this.sendWithProtocol(a).catch(function(t){u.error(t),delete e.callbacks[a.invocationId]}),this.launchStreams(i,o),u},t.prototype.sendMessage=function(t){return this.resetKeepAliveInterval(),this.connection.send(t)},t.prototype.sendWithProtocol=function(t){return this.sendMessage(this.protocol.writeMessage(t))},t.prototype.send=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=this.replaceStreamingParams(e),o=r[0],s=r[1],i=this.sendWithProtocol(this.createInvocation(t,e,!0,s));return this.launchStreams(o,i),i},t.prototype.invoke=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=this.replaceStreamingParams(n),s=o[0],i=o[1],c=this.createInvocation(t,n,!1,i),a=new Promise(function(t,n){e.callbacks[c.invocationId]=function(e,r){r?n(r):e&&(e.type===ie.Completion?e.error?n(new Error(e.error)):t(e.result):n(new Error("Unexpected message type: "+e.type)))};var r=e.sendWithProtocol(c).catch(function(t){n(t),delete e.callbacks[c.invocationId]});e.launchStreams(s,r)});return a},t.prototype.on=function(t,e){!t||!e||(t=t.toLowerCase(),this.methods[t]||(this.methods[t]=[]),-1===this.methods[t].indexOf(e)&&this.methods[t].push(e))},t.prototype.off=function(t,e){if(t){t=t.toLowerCase();var n=this.methods[t];if(n)if(e){var r=n.indexOf(e);-1!==r&&(n.splice(r,1),0===n.length&&delete this.methods[t])}else delete this.methods[t]}},t.prototype.onclose=function(t){t&&this.closedCallbacks.push(t)},t.prototype.onreconnecting=function(t){t&&this.reconnectingCallbacks.push(t)},t.prototype.onreconnected=function(t){t&&this.reconnectedCallbacks.push(t)},t.prototype.processIncomingData=function(t){if(this.cleanupTimeout(),this.receivedHandshakeResponse||(t=this.processHandshakeResponse(t),this.receivedHandshakeResponse=!0),t)for(var e=0,n=this.protocol.parseMessages(t,this.logger);e<n.length;e++){var r=n[e];switch(r.type){case ie.Invocation:this.invokeClientMethod(r);break;case ie.StreamItem:case ie.Completion:var o=this.callbacks[r.invocationId];o&&(r.type===ie.Completion&&delete this.callbacks[r.invocationId],o(r));break;case ie.Ping:break;case ie.Close:this.logger.log(qt.Information,"Close message received from server.");var s=r.error?new Error("Server returned an error on close: "+r.error):void 0;!0===r.allowReconnect?this.connection.stop(s):this.stopPromise=this.stopInternal(s);break;default:this.logger.log(qt.Warning,"Invalid message type: "+r.type+".")}}this.resetTimeoutPeriod()},t.prototype.processHandshakeResponse=function(t){var e,n,r,o;try{r=(e=this.handshakeProtocol.parseHandshakeResponse(t))[0],n=e[1]}catch(i){this.logger.log(qt.Error,o="Error parsing handshake response: "+i);var s=new Error(o);throw this.handshakeRejecter(s),s}if(n.error)throw this.logger.log(qt.Error,o="Server returned handshake error: "+n.error),s=new Error(o),this.handshakeRejecter(s),s;return this.logger.log(qt.Debug,"Server handshake complete."),this.handshakeResolver(),r},t.prototype.resetKeepAliveInterval=function(){this.connection.features.inherentKeepAlive||(this.nextKeepAlive=(new Date).getTime()+this.keepAliveIntervalInMilliseconds,this.cleanupPingTimer())},t.prototype.resetTimeoutPeriod=function(){var t=this;if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this.timeoutHandle=setTimeout(function(){return t.serverTimeout()},this.serverTimeoutInMilliseconds),void 0!==this.pingServerHandle))){var e=this.nextKeepAlive-(new Date).getTime();e<0&&(e=0),this.pingServerHandle=setTimeout(function(){return ae(t,void 0,void 0,function(){return ue(this,function(t){switch(t.label){case 0:if(this.connectionState!==he.Connected)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.sendMessage(this.cachedPingMessage)];case 2:return t.sent(),[3,4];case 3:return t.sent(),this.cleanupPingTimer(),[3,4];case 4:return[2]}})})},e)}},t.prototype.serverTimeout=function(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))},t.prototype.invokeClientMethod=function(t){var e=this,n=this.methods[t.target.toLowerCase()];if(n){try{n.forEach(function(n){return n.apply(e,t.arguments)})}catch(o){this.logger.log(qt.Error,"A callback for the method "+t.target.toLowerCase()+" threw error '"+o+"'.")}if(t.invocationId){var r="Server requested a response, which is not supported in this version of the client.";this.logger.log(qt.Error,r),this.stopPromise=this.stopInternal(new Error(r))}}else this.logger.log(qt.Warning,"No client method with the name '"+t.target+"' found.")},t.prototype.connectionClosed=function(t){this.logger.log(qt.Debug,"HubConnection.connectionClosed("+t+") called while in state "+this.connectionState+"."),this.stopDuringStartError=this.stopDuringStartError||t||new Error("The underlying connection was closed before the hub handshake could complete."),this.handshakeResolver&&this.handshakeResolver(),this.cancelCallbacksWithError(t||new Error("Invocation canceled due to the underlying connection being closed.")),this.cleanupTimeout(),this.cleanupPingTimer(),this.connectionState===he.Disconnecting?this.completeClose(t):this.connectionState===he.Connected&&this.reconnectPolicy?this.reconnect(t):this.connectionState===he.Connected&&this.completeClose(t)},t.prototype.completeClose=function(t){var e=this;if(this.connectionStarted){this.connectionState=he.Disconnected,this.connectionStarted=!1;try{this.closedCallbacks.forEach(function(n){return n.apply(e,[t])})}catch(n){this.logger.log(qt.Error,"An onclose callback called with error '"+t+"' threw error '"+n+"'.")}}},t.prototype.reconnect=function(t){return ae(this,void 0,void 0,function(){var e,n,r,o,s,i=this;return ue(this,function(c){switch(c.label){case 0:if(e=Date.now(),n=0,r=void 0!==t?t:new Error("Attempting to reconnect due to a unknown error."),null===(o=this.getNextRetryDelay(n++,0,r)))return this.logger.log(qt.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this.completeClose(t),[2];if(this.connectionState=he.Reconnecting,this.logger.log(qt.Information,t?"Connection reconnecting because of error '"+t+"'.":"Connection reconnecting."),this.onreconnecting){try{this.reconnectingCallbacks.forEach(function(e){return e.apply(i,[t])})}catch(a){this.logger.log(qt.Error,"An onreconnecting callback called with error '"+t+"' threw error '"+a+"'.")}if(this.connectionState!==he.Reconnecting)return this.logger.log(qt.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting."),[2]}c.label=1;case 1:return null===o?[3,7]:(this.logger.log(qt.Information,"Reconnect attempt number "+n+" will start in "+o+" ms."),[4,new Promise(function(t){i.reconnectDelayHandle=setTimeout(t,o)})]);case 2:if(c.sent(),this.reconnectDelayHandle=void 0,this.connectionState!==he.Reconnecting)return this.logger.log(qt.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting."),[2];c.label=3;case 3:return c.trys.push([3,5,,6]),[4,this.startInternal()];case 4:if(c.sent(),this.connectionState=he.Connected,this.logger.log(qt.Information,"HubConnection reconnected successfully."),this.onreconnected)try{this.reconnectedCallbacks.forEach(function(t){return t.apply(i,[i.connection.connectionId])})}catch(a){this.logger.log(qt.Error,"An onreconnected callback called with connectionId '"+this.connection.connectionId+"; threw error '"+a+"'.")}return[2];case 5:return s=c.sent(),this.logger.log(qt.Information,"Reconnect attempt failed because of error '"+s+"'."),this.connectionState!==he.Reconnecting?(this.logger.log(qt.Debug,"Connection moved to the '"+this.connectionState+"' from the reconnecting state during reconnect attempt. Done reconnecting."),this.connectionState===he.Disconnecting&&this.completeClose(),[2]):(r=s instanceof Error?s:new Error(s.toString()),o=this.getNextRetryDelay(n++,Date.now()-e,r),[3,6]);case 6:return[3,1];case 7:return this.logger.log(qt.Information,"Reconnect retries have been exhausted after "+(Date.now()-e)+" ms and "+n+" failed attempts. Connection disconnecting."),this.completeClose(),[2]}})})},t.prototype.getNextRetryDelay=function(t,e,n){try{return this.reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:e,previousRetryCount:t,retryReason:n})}catch(r){return this.logger.log(qt.Error,"IRetryPolicy.nextRetryDelayInMilliseconds("+t+", "+e+") threw error '"+r+"'."),null}},t.prototype.cancelCallbacksWithError=function(t){var e=this.callbacks;this.callbacks={},Object.keys(e).forEach(function(n){(0,e[n])(null,t)})},t.prototype.cleanupPingTimer=function(){this.pingServerHandle&&(clearTimeout(this.pingServerHandle),this.pingServerHandle=void 0)},t.prototype.cleanupTimeout=function(){this.timeoutHandle&&clearTimeout(this.timeoutHandle)},t.prototype.createInvocation=function(t,e,n,r){if(n)return{arguments:e,streamIds:r,target:t,type:ie.Invocation};var o=this.invocationId;return this.invocationId++,{arguments:e,invocationId:o.toString(),streamIds:r,target:t,type:ie.Invocation}},t.prototype.launchStreams=function(t,e){var n=this;if(0!==t.length){e||(e=Promise.resolve());var r=function(r){t[r].subscribe({complete:function(){e=e.then(function(){return n.sendWithProtocol(n.createCompletionMessage(r))})},error:function(t){var o;o=t instanceof Error?t.message:t&&t.toString?t.toString():"Unknown error",e=e.then(function(){return n.sendWithProtocol(n.createCompletionMessage(r,o))})},next:function(t){e=e.then(function(){return n.sendWithProtocol(n.createStreamItemMessage(r,t))})}})};for(var o in t)r(o)}},t.prototype.replaceStreamingParams=function(t){for(var e=[],n=[],r=0;r<t.length;r++){var o=t[r];if(this.isObservable(o)){var s=this.invocationId;this.invocationId++,e[s]=o,n.push(s.toString()),t.splice(r,1)}}return[e,n]},t.prototype.isObservable=function(t){return t&&t.subscribe&&"function"==typeof t.subscribe},t.prototype.createStreamInvocation=function(t,e,n){var r=this.invocationId;return this.invocationId++,{arguments:e,invocationId:r.toString(),streamIds:n,target:t,type:ie.StreamInvocation}},t.prototype.createCancelInvocation=function(t){return{invocationId:t,type:ie.CancelInvocation}},t.prototype.createStreamItemMessage=function(t,e){return{invocationId:t,item:e,type:ie.StreamItem}},t.prototype.createCompletionMessage=function(t,e,n){return e?{error:e,invocationId:t,type:ie.Completion}:{invocationId:t,result:n,type:ie.Completion}},t}(),pe=[0,2e3,1e4,3e4,null],de=function(){function t(t){this.retryDelays=void 0!==t?t.concat([null]):pe}return t.prototype.nextRetryDelayInMilliseconds=function(t){return this.retryDelays[t.previousRetryCount]},t}(),fe=(()=>(function(t){t[t.None=0]="None",t[t.WebSockets=1]="WebSockets",t[t.ServerSentEvents=2]="ServerSentEvents",t[t.LongPolling=4]="LongPolling"}(fe||(fe={})),fe))(),ge=(()=>(function(t){t[t.Text=1]="Text",t[t.Binary=2]="Binary"}(ge||(ge={})),ge))(),be=function(){function t(){this.isAborted=!1,this.onabort=null}return t.prototype.abort=function(){this.isAborted||(this.isAborted=!0,this.onabort&&this.onabort())},Object.defineProperty(t.prototype,"signal",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aborted",{get:function(){return this.isAborted},enumerable:!0,configurable:!0}),t}(),ye=function(t,e,n,r){return new(n||(n=Promise))(function(o,s){function i(t){try{a(r.next(t))}catch(e){s(e)}}function c(t){try{a(r.throw(t))}catch(e){s(e)}}function a(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(i,c)}a((r=r.apply(t,e||[])).next())})},ve=function(t,e){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function c(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(c){s=[6,c],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},we=function(){function t(t,e,n,r){this.httpClient=t,this.accessTokenFactory=e,this.logger=n,this.pollAbort=new be,this.logMessageContent=r,this.running=!1,this.onreceive=null,this.onclose=null}return Object.defineProperty(t.prototype,"pollAborted",{get:function(){return this.pollAbort.aborted},enumerable:!0,configurable:!0}),t.prototype.connect=function(t,e){return ye(this,void 0,void 0,function(){var n,r,o,s;return ve(this,function(i){switch(i.label){case 0:if(Ut.isRequired(t,"url"),Ut.isRequired(e,"transferFormat"),Ut.isIn(e,ge,"transferFormat"),this.url=t,this.logger.log(qt.Trace,"(LongPolling transport) Connecting."),e===ge.Binary&&"undefined"!=typeof XMLHttpRequest&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");return n={abortSignal:this.pollAbort.signal,headers:{},timeout:1e5},e===ge.Binary&&(n.responseType="arraybuffer"),[4,this.getAccessToken()];case 1:return r=i.sent(),this.updateHeaderToken(n,r),o=t+"&_="+Date.now(),this.logger.log(qt.Trace,"(LongPolling transport) polling: "+o+"."),[4,this.httpClient.get(o,n)];case 2:return 200!==(s=i.sent()).statusCode?(this.logger.log(qt.Error,"(LongPolling transport) Unexpected response code: "+s.statusCode+"."),this.closeError=new Nt(s.statusText||"",s.statusCode),this.running=!1):this.running=!0,this.receiving=this.poll(this.url,n),[2]}})})},t.prototype.getAccessToken=function(){return ye(this,void 0,void 0,function(){return ve(this,function(t){switch(t.label){case 0:return this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:return[2,t.sent()];case 2:return[2,null]}})})},t.prototype.updateHeaderToken=function(t,e){t.headers||(t.headers={}),e?t.headers.Authorization="Bearer "+e:t.headers.Authorization&&delete t.headers.Authorization},t.prototype.poll=function(t,e){return ye(this,void 0,void 0,function(){var n,r,o,s;return ve(this,function(i){switch(i.label){case 0:i.trys.push([0,,8,9]),i.label=1;case 1:return this.running?[4,this.getAccessToken()]:[3,7];case 2:n=i.sent(),this.updateHeaderToken(e,n),i.label=3;case 3:return i.trys.push([3,5,,6]),r=t+"&_="+Date.now(),this.logger.log(qt.Trace,"(LongPolling transport) polling: "+r+"."),[4,this.httpClient.get(r,e)];case 4:return 204===(o=i.sent()).statusCode?(this.logger.log(qt.Information,"(LongPolling transport) Poll terminated by server."),this.running=!1):200!==o.statusCode?(this.logger.log(qt.Error,"(LongPolling transport) Unexpected response code: "+o.statusCode+"."),this.closeError=new Nt(o.statusText||"",o.statusCode),this.running=!1):o.content?(this.logger.log(qt.Trace,"(LongPolling transport) data received. "+Bt(o.content,this.logMessageContent)+"."),this.onreceive&&this.onreceive(o.content)):this.logger.log(qt.Trace,"(LongPolling transport) Poll timed out, reissuing."),[3,6];case 5:return s=i.sent(),this.running?s instanceof At?this.logger.log(qt.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this.closeError=s,this.running=!1):this.logger.log(qt.Trace,"(LongPolling transport) Poll errored after shutdown: "+s.message),[3,6];case 6:return[3,1];case 7:return[3,9];case 8:return this.logger.log(qt.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this.raiseOnClose(),[7];case 9:return[2]}})})},t.prototype.send=function(t){return ye(this,void 0,void 0,function(){return ve(this,function(e){return this.running?[2,Yt(this.logger,"LongPolling",this.httpClient,this.url,this.accessTokenFactory,t,this.logMessageContent)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]})})},t.prototype.stop=function(){return ye(this,void 0,void 0,function(){var t,e;return ve(this,function(n){switch(n.label){case 0:this.logger.log(qt.Trace,"(LongPolling transport) Stopping polling."),this.running=!1,this.pollAbort.abort(),n.label=1;case 1:return n.trys.push([1,,5,6]),[4,this.receiving];case 2:return n.sent(),this.logger.log(qt.Trace,"(LongPolling transport) sending DELETE request to "+this.url+"."),t={headers:{}},[4,this.getAccessToken()];case 3:return e=n.sent(),this.updateHeaderToken(t,e),[4,this.httpClient.delete(this.url,t)];case 4:return n.sent(),this.logger.log(qt.Trace,"(LongPolling transport) DELETE request sent."),[3,6];case 5:return this.logger.log(qt.Trace,"(LongPolling transport) Stop finished."),this.raiseOnClose(),[7];case 6:return[2]}})})},t.prototype.raiseOnClose=function(){if(this.onclose){var t="(LongPolling transport) Firing onclose event.";this.closeError&&(t+=" Error: "+this.closeError),this.logger.log(qt.Trace,t),this.onclose(this.closeError)}},t}(),me=function(t,e,n,r){return new(n||(n=Promise))(function(o,s){function i(t){try{a(r.next(t))}catch(e){s(e)}}function c(t){try{a(r.throw(t))}catch(e){s(e)}}function a(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(i,c)}a((r=r.apply(t,e||[])).next())})},Se=function(t,e){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function c(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(c){s=[6,c],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},Ee=function(){function t(t,e,n,r,o){this.httpClient=t,this.accessTokenFactory=e,this.logger=n,this.logMessageContent=r,this.eventSourceConstructor=o,this.onreceive=null,this.onclose=null}return t.prototype.connect=function(t,e){return me(this,void 0,void 0,function(){var n,r=this;return Se(this,function(o){switch(o.label){case 0:return Ut.isRequired(t,"url"),Ut.isRequired(e,"transferFormat"),Ut.isIn(e,ge,"transferFormat"),this.logger.log(qt.Trace,"(SSE transport) Connecting."),this.url=t,this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(n=o.sent())&&(t+=(t.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(n)),o.label=2;case 2:return[2,new Promise(function(n,o){var s=!1;if(e===ge.Text){var i;if(Vt.isBrowser||Vt.isWebWorker)i=new r.eventSourceConstructor(t,{withCredentials:!0});else{var c=r.httpClient.getCookieString(t);i=new r.eventSourceConstructor(t,{withCredentials:!0,headers:{Cookie:c}})}try{i.onmessage=function(t){if(r.onreceive)try{r.logger.log(qt.Trace,"(SSE transport) data received. "+Bt(t.data,r.logMessageContent)+"."),r.onreceive(t.data)}catch(e){return void r.close(e)}},i.onerror=function(t){var e=new Error(t.data||"Error occurred");s?r.close(e):o(e)},i.onopen=function(){r.logger.log(qt.Information,"SSE connected to "+r.url),r.eventSource=i,s=!0,n()}}catch(a){return void o(a)}}else o(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))})]}})})},t.prototype.send=function(t){return me(this,void 0,void 0,function(){return Se(this,function(e){return this.eventSource?[2,Yt(this.logger,"SSE",this.httpClient,this.url,this.accessTokenFactory,t,this.logMessageContent)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]})})},t.prototype.stop=function(){return this.close(),Promise.resolve()},t.prototype.close=function(t){this.eventSource&&(this.eventSource.close(),this.eventSource=void 0,this.onclose&&this.onclose(t))},t}(),Ce=function(){function t(t,e,n,r,o){this.logger=n,this.accessTokenFactory=e,this.logMessageContent=r,this.webSocketConstructor=o,this.httpClient=t,this.onreceive=null,this.onclose=null}return t.prototype.connect=function(t,e){return function(t,e,n,r){return new(n||(n=Promise))(function(e,o){function s(t){try{c(r.next(t))}catch(e){o(e)}}function i(t){try{c(r.throw(t))}catch(e){o(e)}}function c(t){t.done?e(t.value):new n(function(e){e(t.value)}).then(s,i)}c((r=r.apply(t,[])).next())})}(this,0,void 0,function(){var n,r=this;return function(t,e){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function c(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(c){s=[6,c],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}(this,function(o){switch(o.label){case 0:return Ut.isRequired(t,"url"),Ut.isRequired(e,"transferFormat"),Ut.isIn(e,ge,"transferFormat"),this.logger.log(qt.Trace,"(WebSockets transport) Connecting."),this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(n=o.sent())&&(t+=(t.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(n)),o.label=2;case 2:return[2,new Promise(function(n,o){t=t.replace(/^http/,"ws");var s,i=r.httpClient.getCookieString(t),c=!1;Vt.isNode&&i&&(s=new r.webSocketConstructor(t,void 0,{headers:{Cookie:""+i}})),s||(s=new r.webSocketConstructor(t)),e===ge.Binary&&(s.binaryType="arraybuffer"),s.onopen=function(e){r.logger.log(qt.Information,"WebSocket connected to "+t+"."),r.webSocket=s,c=!0,n()},s.onerror=function(t){var e;e="undefined"!=typeof ErrorEvent&&t instanceof ErrorEvent?t.error:new Error("There was an error with the transport."),o(e)},s.onmessage=function(t){r.logger.log(qt.Trace,"(WebSockets transport) data received. "+Bt(t.data,r.logMessageContent)+"."),r.onreceive&&r.onreceive(t.data)},s.onclose=function(t){if(c)r.close(t);else{var e;e="undefined"!=typeof ErrorEvent&&t instanceof ErrorEvent?t.error:new Error("There was an error with the transport."),o(e)}}})]}})})},t.prototype.send=function(t){return this.webSocket&&this.webSocket.readyState===this.webSocketConstructor.OPEN?(this.logger.log(qt.Trace,"(WebSockets transport) sending data. "+Bt(t,this.logMessageContent)+"."),this.webSocket.send(t),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")},t.prototype.stop=function(){return this.webSocket&&this.close(void 0),Promise.resolve()},t.prototype.close=function(t){this.webSocket&&(this.webSocket.onclose=function(){},this.webSocket.onmessage=function(){},this.webSocket.onerror=function(){},this.webSocket.close(),this.webSocket=void 0),this.logger.log(qt.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!t||!1!==t.wasClean&&1e3===t.code?this.onclose():this.onclose(new Error("WebSocket closed with status code: "+t.code+" ("+t.reason+").")))},t}(),xe=function(t,e,n,r){return new(n||(n=Promise))(function(o,s){function i(t){try{a(r.next(t))}catch(e){s(e)}}function c(t){try{a(r.throw(t))}catch(e){s(e)}}function a(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(i,c)}a((r=r.apply(t,e||[])).next())})},_e=function(t,e){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function c(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(c){s=[6,c],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},Te=null,ke=null;if(Vt.isNode){var Ie=require;Te=Ie("ws"),ke=Ie("eventsource")}var Pe=function(){function t(t,e){void 0===e&&(e={}),this.stopPromiseResolver=function(){},this.features={},this.negotiateVersion=1,Ut.isRequired(t,"url"),this.logger=function(t){return void 0===t?new Gt(qt.Information):null===t?Lt.instance:t.log?t:new Gt(t)}(e.logger),this.baseUrl=this.resolveUrl(t),(e=e||{}).logMessageContent=e.logMessageContent||!1,Vt.isNode||"undefined"==typeof WebSocket||e.WebSocket?Vt.isNode&&!e.WebSocket&&Te&&(e.WebSocket=Te):e.WebSocket=WebSocket,Vt.isNode||"undefined"==typeof EventSource||e.EventSource?Vt.isNode&&!e.EventSource&&void 0!==ke&&(e.EventSource=ke):e.EventSource=EventSource,this.httpClient=e.httpClient||new re(this.logger),this.connectionState="Disconnected",this.connectionStarted=!1,this.options=e,this.onreceive=null,this.onclose=null}return t.prototype.start=function(t){return xe(this,void 0,void 0,function(){var e;return _e(this,function(n){switch(n.label){case 0:return Ut.isIn(t=t||ge.Binary,ge,"transferFormat"),this.logger.log(qt.Debug,"Starting connection with transfer format '"+ge[t]+"'."),"Disconnected"!==this.connectionState?[2,Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."))]:(this.connectionState="Connecting ",this.startInternalPromise=this.startInternal(t),[4,this.startInternalPromise]);case 1:return n.sent(),"Disconnecting"!==this.connectionState?[3,3]:(this.logger.log(qt.Error,e="Failed to start the HttpConnection before stop() was called."),[4,this.stopPromise]);case 2:return n.sent(),[2,Promise.reject(new Error(e))];case 3:if("Connected"!==this.connectionState)return this.logger.log(qt.Error,e="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!"),[2,Promise.reject(new Error(e))];n.label=4;case 4:return this.connectionStarted=!0,[2]}})})},t.prototype.send=function(t){return"Connected"!==this.connectionState?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this.sendQueue||(this.sendQueue=new De(this.transport)),this.sendQueue.send(t))},t.prototype.stop=function(t){return xe(this,void 0,void 0,function(){var e=this;return _e(this,function(n){switch(n.label){case 0:return"Disconnected"===this.connectionState?(this.logger.log(qt.Debug,"Call to HttpConnection.stop("+t+") ignored because the connection is already in the disconnected state."),[2,Promise.resolve()]):"Disconnecting"===this.connectionState?(this.logger.log(qt.Debug,"Call to HttpConnection.stop("+t+") ignored because the connection is already in the disconnecting state."),[2,this.stopPromise]):(this.connectionState="Disconnecting",this.stopPromise=new Promise(function(t){e.stopPromiseResolver=t}),[4,this.stopInternal(t)]);case 1:return n.sent(),[4,this.stopPromise];case 2:return n.sent(),[2]}})})},t.prototype.stopInternal=function(t){return xe(this,void 0,void 0,function(){var e;return _e(this,function(n){switch(n.label){case 0:this.stopError=t,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.startInternalPromise];case 2:case 3:return n.sent(),[3,4];case 4:if(!this.transport)return[3,9];n.label=5;case 5:return n.trys.push([5,7,,8]),[4,this.transport.stop()];case 6:return n.sent(),[3,8];case 7:return e=n.sent(),this.logger.log(qt.Error,"HttpConnection.transport.stop() threw error '"+e+"'."),this.stopConnection(),[3,8];case 8:return this.transport=void 0,[3,10];case 9:this.logger.log(qt.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed."),n.label=10;case 10:return[2]}})})},t.prototype.startInternal=function(t){return xe(this,void 0,void 0,function(){var e,n,r,o,s,i;return _e(this,function(c){switch(c.label){case 0:e=this.baseUrl,this.accessTokenFactory=this.options.accessTokenFactory,c.label=1;case 1:return c.trys.push([1,12,,13]),this.options.skipNegotiation?this.options.transport!==fe.WebSockets?[3,3]:(this.transport=this.constructTransport(fe.WebSockets),[4,this.startTransport(e,t)]):[3,5];case 2:return c.sent(),[3,4];case 3:throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");case 4:return[3,11];case 5:n=null,r=0,o=function(){var t;return _e(this,function(o){switch(o.label){case 0:return[4,s.getNegotiationResponse(e)];case 1:if(n=o.sent(),"Disconnecting"===s.connectionState||"Disconnected"===s.connectionState)throw new Error("The connection was stopped during negotiation.");if(n.error)throw new Error(n.error);if(n.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");return n.url&&(e=n.url),n.accessToken&&(t=n.accessToken,s.accessTokenFactory=function(){return t}),r++,[2]}})},s=this,c.label=6;case 6:return[5,o()];case 7:c.sent(),c.label=8;case 8:if(n.url&&r<100)return[3,6];c.label=9;case 9:if(100===r&&n.url)throw new Error("Negotiate redirection limit exceeded.");return[4,this.createTransport(e,this.options.transport,n,t)];case 10:c.sent(),c.label=11;case 11:return this.transport instanceof we&&(this.features.inherentKeepAlive=!0),"Connecting "===this.connectionState&&(this.logger.log(qt.Debug,"The HttpConnection connected successfully."),this.connectionState="Connected"),[3,13];case 12:return i=c.sent(),this.logger.log(qt.Error,"Failed to start the connection: "+i),this.connectionState="Disconnected",this.transport=void 0,this.stopPromiseResolver(),[2,Promise.reject(i)];case 13:return[2]}})})},t.prototype.getNegotiationResponse=function(t){return xe(this,void 0,void 0,function(){var e,n,r,o,s,i,c;return _e(this,function(a){switch(a.label){case 0:return this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(r=a.sent())&&((e={}).Authorization="Bearer "+r,n=e),a.label=2;case 2:o=this.resolveNegotiateUrl(t),this.logger.log(qt.Debug,"Sending negotiation request: "+o+"."),a.label=3;case 3:return a.trys.push([3,5,,6]),[4,this.httpClient.post(o,{content:"",headers:n})];case 4:return 200!==(s=a.sent()).statusCode?[2,Promise.reject(new Error("Unexpected status code returned from negotiate "+s.statusCode))]:((!(i=JSON.parse(s.content)).negotiateVersion||i.negotiateVersion<1)&&(i.connectionToken=i.connectionId),[2,i]);case 5:return c=a.sent(),this.logger.log(qt.Error,"Failed to complete negotiation with the server: "+c),[2,Promise.reject(c)];case 6:return[2]}})})},t.prototype.createConnectUrl=function(t,e){return e?t+(-1===t.indexOf("?")?"?":"&")+"id="+e:t},t.prototype.createTransport=function(t,e,n,r){return xe(this,void 0,void 0,function(){var o,s,i,c,a,u,h,l,p;return _e(this,function(d){switch(d.label){case 0:return o=this.createConnectUrl(t,n.connectionToken),this.isITransport(e)?(this.logger.log(qt.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=e,[4,this.startTransport(o,r)]):[3,2];case 1:return d.sent(),this.connectionId=n.connectionId,[2];case 2:s=[],i=n,c=0,a=n.availableTransports||[],d.label=3;case 3:return c<a.length?(h=this.resolveTransportOrError(u=a[c],e,r))instanceof Error?(s.push(u.transport+" failed: "+h),[3,12]):[3,4]:[3,13];case 4:if(!this.isITransport(h))return[3,12];if(this.transport=h,i)return[3,9];d.label=5;case 5:return d.trys.push([5,7,,8]),[4,this.getNegotiationResponse(t)];case 6:return i=d.sent(),[3,8];case 7:return l=d.sent(),[2,Promise.reject(l)];case 8:o=this.createConnectUrl(t,i.connectionToken),d.label=9;case 9:return d.trys.push([9,11,,12]),[4,this.startTransport(o,r)];case 10:return d.sent(),this.connectionId=i.connectionId,[2];case 11:return p=d.sent(),this.logger.log(qt.Error,"Failed to start the transport '"+u.transport+"': "+p),i=void 0,s.push(u.transport+" failed: "+p),"Connecting "!==this.connectionState?(this.logger.log(qt.Debug,"Failed to select transport before stop() was called."),[2,Promise.reject(new Error("Failed to select transport before stop() was called."))]):[3,12];case 12:return c++,[3,3];case 13:return s.length>0?[2,Promise.reject(new Error("Unable to connect to the server with any of the available transports. "+s.join(" ")))]:[2,Promise.reject(new Error("None of the transports supported by the client are supported by the server."))]}})})},t.prototype.constructTransport=function(t){switch(t){case fe.WebSockets:if(!this.options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new Ce(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.WebSocket);case fe.ServerSentEvents:if(!this.options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new Ee(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.EventSource);case fe.LongPolling:return new we(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1);default:throw new Error("Unknown transport: "+t+".")}},t.prototype.startTransport=function(t,e){var n=this;return this.transport.onreceive=this.onreceive,this.transport.onclose=function(t){return n.stopConnection(t)},this.transport.connect(t,e)},t.prototype.resolveTransportOrError=function(t,e,n){var r=fe[t.transport];if(null==r)return this.logger.log(qt.Debug,"Skipping transport '"+t.transport+"' because it is not supported by this client."),new Error("Skipping transport '"+t.transport+"' because it is not supported by this client.");if(!function(t,e){return!t||0!=(e&t)}(e,r))return this.logger.log(qt.Debug,"Skipping transport '"+fe[r]+"' because it was disabled by the client."),new Error("'"+fe[r]+"' is disabled by the client.");if(!(t.transferFormats.map(function(t){return ge[t]}).indexOf(n)>=0))return this.logger.log(qt.Debug,"Skipping transport '"+fe[r]+"' because it does not support the requested transfer format '"+ge[n]+"'."),new Error("'"+fe[r]+"' does not support "+ge[n]+".");if(r===fe.WebSockets&&!this.options.WebSocket||r===fe.ServerSentEvents&&!this.options.EventSource)return this.logger.log(qt.Debug,"Skipping transport '"+fe[r]+"' because it is not supported in your environment.'"),new Error("'"+fe[r]+"' is not supported in your environment.");this.logger.log(qt.Debug,"Selecting transport '"+fe[r]+"'.");try{return this.constructTransport(r)}catch(o){return o}},t.prototype.isITransport=function(t){return t&&"object"==typeof t&&"connect"in t},t.prototype.stopConnection=function(t){var e=this;if(this.logger.log(qt.Debug,"HttpConnection.stopConnection("+t+") called while in state "+this.connectionState+"."),this.transport=void 0,t=this.stopError||t,this.stopError=void 0,"Disconnected"!==this.connectionState)if("Connecting "!==this.connectionState){if("Disconnecting"===this.connectionState&&this.stopPromiseResolver(),t?this.logger.log(qt.Error,"Connection disconnected with error '"+t+"'."):this.logger.log(qt.Information,"Connection disconnected."),this.sendQueue&&(this.sendQueue.stop().catch(function(t){e.logger.log(qt.Error,"TransportSendQueue.stop() threw error '"+t+"'.")}),this.sendQueue=void 0),this.connectionId=void 0,this.connectionState="Disconnected",this.connectionStarted){this.connectionStarted=!1;try{this.onclose&&this.onclose(t)}catch(n){this.logger.log(qt.Error,"HttpConnection.onclose("+t+") threw error '"+n+"'.")}}}else this.logger.log(qt.Warning,"Call to HttpConnection.stopConnection("+t+") was ignored because the connection hasn't yet left the in the connecting state.");else this.logger.log(qt.Debug,"Call to HttpConnection.stopConnection("+t+") was ignored because the connection is already in the disconnected state.")},t.prototype.resolveUrl=function(t){if(0===t.lastIndexOf("https://",0)||0===t.lastIndexOf("http://",0))return t;if(!Vt.isBrowser||!window.document)throw new Error("Cannot resolve '"+t+"'.");var e=window.document.createElement("a");return e.href=t,this.logger.log(qt.Information,"Normalizing '"+t+"' to '"+e.href+"'."),e.href},t.prototype.resolveNegotiateUrl=function(t){var e=t.indexOf("?"),n=t.substring(0,-1===e?t.length:e);return"/"!==n[n.length-1]&&(n+="/"),n+="negotiate",-1===(n+=-1===e?"":t.substring(e)).indexOf("negotiateVersion")&&(n+=-1===e?"?":"&",n+="negotiateVersion="+this.negotiateVersion),n},t}(),De=function(){function t(t){this.transport=t,this.buffer=[],this.executing=!0,this.sendBufferedData=new Oe,this.transportResult=new Oe,this.sendLoopPromise=this.sendLoop()}return t.prototype.send=function(t){return this.bufferData(t),this.transportResult||(this.transportResult=new Oe),this.transportResult.promise},t.prototype.stop=function(){return this.executing=!1,this.sendBufferedData.resolve(),this.sendLoopPromise},t.prototype.bufferData=function(t){if(this.buffer.length&&typeof this.buffer[0]!=typeof t)throw new Error("Expected data to be of type "+typeof this.buffer+" but was of type "+typeof t);this.buffer.push(t),this.sendBufferedData.resolve()},t.prototype.sendLoop=function(){return xe(this,void 0,void 0,function(){var e,n,r;return _e(this,function(o){switch(o.label){case 0:return[4,this.sendBufferedData.promise];case 1:if(o.sent(),!this.executing)return this.transportResult&&this.transportResult.reject("Connection stopped."),[3,6];this.sendBufferedData=new Oe,e=this.transportResult,this.transportResult=void 0,n="string"==typeof this.buffer[0]?this.buffer.join(""):t.concatBuffers(this.buffer),this.buffer.length=0,o.label=2;case 2:return o.trys.push([2,4,,5]),[4,this.transport.send(n)];case 3:return o.sent(),e.resolve(),[3,5];case 4:return r=o.sent(),e.reject(r),[3,5];case 5:return[3,0];case 6:return[2]}})})},t.concatBuffers=function(t){for(var e=t.map(function(t){return t.byteLength}).reduce(function(t,e){return t+e}),n=new Uint8Array(e),r=0,o=0,s=t;o<s.length;o++){var i=s[o];n.set(new Uint8Array(i),r),r+=i.byteLength}return n},t}(),Oe=function(){function t(){var t=this;this.promise=new Promise(function(e,n){var r;return t.resolver=(r=[e,n])[0],t.rejecter=r[1],r})}return t.prototype.resolve=function(){this.resolver()},t.prototype.reject=function(t){this.rejecter(t)},t}(),Re=function(){function t(){this.name="json",this.version=1,this.transferFormat=ge.Text}return t.prototype.parseMessages=function(t,e){if("string"!=typeof t)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!t)return[];null===e&&(e=Lt.instance);for(var n=[],r=0,o=oe.parse(t);r<o.length;r++){var s=JSON.parse(o[r]);if("number"!=typeof s.type)throw new Error("Invalid payload.");switch(s.type){case ie.Invocation:this.isInvocationMessage(s);break;case ie.StreamItem:this.isStreamItemMessage(s);break;case ie.Completion:this.isCompletionMessage(s);break;case ie.Ping:case ie.Close:break;default:e.log(qt.Information,"Unknown message type '"+s.type+"' ignored.");continue}n.push(s)}return n},t.prototype.writeMessage=function(t){return oe.write(JSON.stringify(t))},t.prototype.isInvocationMessage=function(t){this.assertNotEmptyString(t.target,"Invalid payload for Invocation message."),void 0!==t.invocationId&&this.assertNotEmptyString(t.invocationId,"Invalid payload for Invocation message.")},t.prototype.isStreamItemMessage=function(t){if(this.assertNotEmptyString(t.invocationId,"Invalid payload for StreamItem message."),void 0===t.item)throw new Error("Invalid payload for StreamItem message.")},t.prototype.isCompletionMessage=function(t){if(t.result&&t.error)throw new Error("Invalid payload for Completion message.");!t.result&&t.error&&this.assertNotEmptyString(t.error,"Invalid payload for Completion message."),this.assertNotEmptyString(t.invocationId,"Invalid payload for Completion message.")},t.prototype.assertNotEmptyString=function(t,e){if("string"!=typeof t||""===t)throw new Error(e)},t}(),je=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},Ne={trace:qt.Trace,debug:qt.Debug,info:qt.Information,information:qt.Information,warn:qt.Warning,warning:qt.Warning,error:qt.Error,critical:qt.Critical,none:qt.None},Ae=function(){function t(){}return t.prototype.configureLogging=function(t){if(Ut.isRequired(t,"logging"),function(t){return void 0!==t.log}(t))this.logger=t;else if("string"==typeof t){var e=function(t){var e=Ne[t.toLowerCase()];if(void 0!==e)return e;throw new Error("Unknown log level: "+t)}(t);this.logger=new Gt(e)}else this.logger=new Gt(t);return this},t.prototype.withUrl=function(t,e){return Ut.isRequired(t,"url"),this.url=t,this.httpConnectionOptions=je({},this.httpConnectionOptions,"object"==typeof e?e:{transport:e}),this},t.prototype.withHubProtocol=function(t){return Ut.isRequired(t,"protocol"),this.protocol=t,this},t.prototype.withAutomaticReconnect=function(t){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return this.reconnectPolicy=t?Array.isArray(t)?new de(t):t:new de,this},t.prototype.build=function(){var t=this.httpConnectionOptions||{};if(void 0===t.logger&&(t.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");var e=new Pe(this.url,t);return le.create(e,this.logger||Lt.instance,this.protocol||new Re,this.reconnectPolicy)},t}();const Me=new T(x);function He(t){return!s(t)&&t-parseFloat(t)+1>=0}function We(t){const{index:e,period:n,subscriber:r}=t;if(r.next(e),!r.closed){if(-1===n)return r.complete();t.index=e+1,this.schedule(t,n)}}const Fe=(()=>{function t(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return t.prototype=Object.create(Error.prototype),t})();function qe(t=null){return e=>e.lift(new Le(t))}class Le{constructor(t){this.defaultValue=t}call(t,e){return e.subscribe(new Ue(t,this.defaultValue))}}class Ue extends p{constructor(t,e){super(t),this.defaultValue=e,this.isEmpty=!0}_next(t){this.isEmpty=!1,this.destination.next(t)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function Ve(t=Ye){return e=>e.lift(new Be(t))}class Be{constructor(t){this.errorFactory=t}call(t,e){return e.subscribe(new $e(t,this.errorFactory))}}class $e extends p{constructor(t,e){super(t),this.errorFactory=e,this.hasValue=!1}_next(t){this.hasValue=!0,this.destination.next(t)}_complete(){if(this.hasValue)return this.destination.complete();{let e;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)}}}function Ye(){return new Fe}function ze(t,e){const n=arguments.length>=2;return r=>r.pipe(t?mt((e,n)=>t(e,n,r)):g,U(1),n?qe(e):Ve(()=>new Fe))}class Je{constructor(t){this.selector=t}call(t,e){return e.subscribe(new Ge(t,this.selector,this.caught))}}class Ge extends ht{constructor(t,e,n){super(t),this.selector=e,this.caught=n}error(t){if(!this.isStopped){let n;try{n=this.selector(t,this.caught)}catch(e){return void super.error(e)}this._unsubscribeAndRecycle();const r=new ut(this);this.add(r);const o=lt(n,r);o!==r&&this.add(o)}}}function Xe(t){return t.adsbTracks=t.adsbTracks||[],t.externalPointingTracks=t.externalPointingTracks||[],t.rfTracks=t.rfTracks||[],t}function Ke(t){return t.trackingObjects=t.trackingObjects.map(Xe),t}class Qe extends class{constructor(t,e){this._connectionStatusSubject=new F(1),this._connection=(new Ae).withUrl(e+t).configureLogging(qt.Warning).withAutomaticReconnect({nextRetryDelayInMilliseconds:t=>5e3}).build(),this._connection.onreconnecting(t=>this._handleConnectionError(t,"Reconnecting! See next info:")),this._connection.onreconnected(t=>this._handleConnectionSuccess())}get connectionStatu$(){return this._connectionStatusSubject.asObservable()}get connectionId(){return this._connection.connectionId}startConnection(){this._connection.state===he.Disconnected&&(this._riseConnectionStateChangedEvent(null,he.Connecting),this._connection.start().then(t=>this._handleConnectionSuccess(),t=>this._handleConnectionError(t)).catch(t=>this._handleConnectionError(t)))}stopConnection(){this._connection.state===he.Connected&&(this._riseConnectionStateChangedEvent(null,he.Disconnecting),this._connection.stop().then(t=>this._handleConnectionStopped(),t=>this._handleConnectionError(t)).catch(t=>this._handleConnectionError(t)))}_handleConnectionSuccess(){console.info("Connected to SignalR hub!"),this._riseConnectionStateChangedEvent()}_handleConnectionError(t,e="Connect to SignalR hub failed: see next error."){console.error(e),console.error(t),this._riseConnectionStateChangedEvent(t)}_handleConnectionStopped(){console.info("Disconnected from SignalR hub!"),this._riseConnectionStateChangedEvent()}_riseConnectionStateChangedEvent(t=null,e=null){this._connectionStatusSubject.next({state:e||this._connection.state,error:t,connectionId:this._connection.connectionId})}}{constructor(t){super("/monitoring-v3",t+"hubs"),this.startConnection()}getTimepointsStream(t){return this.connectionStatu$.pipe(mt(t=>t.state===he.Connected),ze(),pt(e=>this.getWrappedTimepointsStream(t)),X(Ke),function(t){return function(e){const n=new Je(t),r=e.lift(n);return n.caught=r}}(e=>wt(function(t=0,e,n){let r=-1;return He(e)?r=Number(e)<1?1:Number(e):D(e)&&(n=e),D(n)||(n=Me),new b(e=>{const o=He(t)?t:+t-n.now();return n.schedule(We,o,{index:0,period:r,subscriber:e})})}(10).pipe(pt(()=>N(e))),this.connectionStatu$.pipe(mt(t=>t.state!==he.Connected))).pipe(ze(),pt(()=>this.getTimepointsStream(t)))))}getWrappedTimepointsStream(t){return new b(e=>(this._connection.invoke("SubscribeOnArea",t).then(()=>{this._connection.on("OnTimepoint",t=>e.next(t)),this._connection.onreconnecting(t=>e.error(t))}).catch(t=>e.error(t)),{unsubscribe:()=>{this._connection.invoke("UnsubscribeClient").then(()=>this._connection.off("OnTimepoint"))}}))}}!function(t,...e){const n=Array.isArray(e)?new t(J.messages$,...e):new t(J.messages$);G.push(n)}(class extends class{constructor(t){this.messages$=t,this.init$=It(t=>t.pipe(Ct(Y),function(t){return e=>e.lift(new Pt(t))}(z()))),this.initPayload$=this.messages$.pipe(Ct(Y),X(({initPayload:t})=>t),function(t,e,n){let r;return r=t&&"object"==typeof t?t:{bufferSize:t,windowTime:e,refCount:!1,scheduler:n},t=>t.lift(function({bufferSize:t=Number.POSITIVE_INFINITY,windowTime:e=Number.POSITIVE_INFINITY,refCount:n,scheduler:r}){let o,s,i=0,c=!1,a=!1;return function(u){let h;i++,!o||c?(c=!1,o=new F(t,e,r),h=o.subscribe(this),s=u.subscribe({next(t){o.next(t)},error(t){c=!0,o.error(t)},complete(){a=!0,s=void 0,o.complete()}}),a&&(s=void 0)):h=o.subscribe(this),this.add(()=>{i--,h.unsubscribe(),h=void 0,s&&!a&&n&&0===i&&(s.unsubscribe(),s=void 0,o=void 0)})}}(r))}(1))}}{constructor(t){super(t),this.startMonitoring$=It(()=>wt(this.messages$.pipe(Ct(Ot.startMonitoring),X(({areaId:t})=>({isStarted:!0,areaId:t}))),this.messages$.pipe(Ct(Ot.stopMonitoring),X(()=>({isStarted:!1,areaId:null})))).pipe(function(...t){return e=>{let n;return"function"==typeof t[t.length-1]&&(n=t.pop()),e.lift(new it(t,n))}}(this.initPayload$),pt(([{isStarted:t,areaId:e},{backendApiUrl:n}])=>t?new Qe(n).getTimepointsStream(e):I),X((t,e)=>Rt.timePointReceive({timePoint:t,isFirstTimepoint:0===e}))))}})}();